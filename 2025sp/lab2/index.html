
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../lab1/">
      
      
        <link rel="next" href="../lab3/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.14">
    
    
      
        <title>Lab 2 - Performance Modeling - FORCE AI</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.342714a4.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="cyan" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#lab-2-performance-modeling" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="FORCE AI" class="md-header__button md-logo" aria-label="FORCE AI" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            FORCE AI
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Lab 2 - Performance Modeling
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="cyan" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="blue" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
      <div class="md-header__option">
  <div class="md-select">
    
    <button class="md-header__button md-icon" aria-label="Select language">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m12.87 15.07-2.54-2.51.03-.03A17.5 17.5 0 0 0 14.07 6H17V4h-7V2H8v2H1v2h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2zm-2.62 7 1.62-4.33L19.12 17z"/></svg>
    </button>
    <div class="md-select__inner">
      <ul class="md-select__list">
        
          <li class="md-select__item">
            <a href="./" hreflang="en" class="md-select__link">
              English
            </a>
          </li>
        
          <li class="md-select__item">
            <a href="../../zh/2025sp/lab2/" hreflang="zh" class="md-select__link">
              繁體中文
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</div>
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/NCKU-AISLAB/force-ai" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    aislab/force-ai
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../quick-start/" class="md-tabs__link">
        
  
  
    
  
  Quick Start

      </a>
    </li>
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../lab1/" class="md-tabs__link">
          
  
  
  Tutorial

        </a>
      </li>
    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../developers/" class="md-tabs__link">
        
  
  
    
  
  Developer Guides

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="FORCE AI" class="md-nav__button md-logo" aria-label="FORCE AI" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    FORCE AI
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/NCKU-AISLAB/force-ai" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    aislab/force-ai
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../quick-start/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quick Start
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Tutorial
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Tutorial
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lab1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lab 1 - AI Model Design and Quantization
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Lab 2 - Performance Modeling
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Lab 2 - Performance Modeling
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      Overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lab-21-workload-analysis-and-network-parsing" class="md-nav__link">
    <span class="md-ellipsis">
      Lab 2.1 - Workload Analysis and Network Parsing
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Lab 2.1 - Workload Analysis and Network Parsing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#workload-analysis-to-identify-the-performance-bottleneck" class="md-nav__link">
    <span class="md-ellipsis">
      Workload Analysis to Identify the Performance Bottleneck
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network-parsing-to-automate-the-analysis-workflow" class="md-nav__link">
    <span class="md-ellipsis">
      Network Parsing to Automate the Analysis Workflow
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lab-22-analytical-model-for-eyeriss-dla" class="md-nav__link">
    <span class="md-ellipsis">
      Lab 2.2 - Analytical Model for Eyeriss DLA
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Lab 2.2 - Analytical Model for Eyeriss DLA">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#introduction-to-performance-modeling" class="md-nav__link">
    <span class="md-ellipsis">
      Introduction to Performance Modeling
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hardware-parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Hardware Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dataflow-mapping-parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Dataflow Mapping Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pe-set" class="md-nav__link">
    <span class="md-ellipsis">
      PE Set
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#summary-of-notation" class="md-nav__link">
    <span class="md-ellipsis">
      Summary of Notation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tiling-strategy-and-loop-ordering" class="md-nav__link">
    <span class="md-ellipsis">
      Tiling Strategy and Loop Ordering
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#performance-metrics" class="md-nav__link">
    <span class="md-ellipsis">
      Performance Metrics
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    <span class="md-ellipsis">
      Summary
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#implementation-of-analytical-model" class="md-nav__link">
    <span class="md-ellipsis">
      Implementation of Analytical Model
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#integration-with-network-parser" class="md-nav__link">
    <span class="md-ellipsis">
      Integration with Network Parser
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lab-23-design-space-exploration-dse" class="md-nav__link">
    <span class="md-ellipsis">
      Lab 2.3 - Design Space Exploration (DSE)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Lab 2.3 - Design Space Exploration (DSE)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#roofline-model" class="md-nav__link">
    <span class="md-ellipsis">
      Roofline Model
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mapping-parameter-search" class="md-nav__link">
    <span class="md-ellipsis">
      Mapping Parameter Search
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hardware-parameter-search" class="md-nav__link">
    <span class="md-ellipsis">
      Hardware Parameter Search
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#practice" class="md-nav__link">
    <span class="md-ellipsis">
      Practice
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Practice">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    <span class="md-ellipsis">
      Prerequisites
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1-workload-analysis" class="md-nav__link">
    <span class="md-ellipsis">
      1. Workload Analysis
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-network-parser" class="md-nav__link">
    <span class="md-ellipsis">
      2. Network Parser
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-analytical-model" class="md-nav__link">
    <span class="md-ellipsis">
      3. Analytical Model
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-roofline-model" class="md-nav__link">
    <span class="md-ellipsis">
      4. Roofline Model
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-design-space-exploration" class="md-nav__link">
    <span class="md-ellipsis">
      5. Design Space Exploration
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lab3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lab 3 - Hardware Architecture Design
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lab4/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lab 4 - Runtime and Performance Profiling
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lab5/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lab 5 - AI Compiler
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../developers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Developer Guides
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      Overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lab-21-workload-analysis-and-network-parsing" class="md-nav__link">
    <span class="md-ellipsis">
      Lab 2.1 - Workload Analysis and Network Parsing
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Lab 2.1 - Workload Analysis and Network Parsing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#workload-analysis-to-identify-the-performance-bottleneck" class="md-nav__link">
    <span class="md-ellipsis">
      Workload Analysis to Identify the Performance Bottleneck
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network-parsing-to-automate-the-analysis-workflow" class="md-nav__link">
    <span class="md-ellipsis">
      Network Parsing to Automate the Analysis Workflow
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lab-22-analytical-model-for-eyeriss-dla" class="md-nav__link">
    <span class="md-ellipsis">
      Lab 2.2 - Analytical Model for Eyeriss DLA
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Lab 2.2 - Analytical Model for Eyeriss DLA">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#introduction-to-performance-modeling" class="md-nav__link">
    <span class="md-ellipsis">
      Introduction to Performance Modeling
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hardware-parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Hardware Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dataflow-mapping-parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Dataflow Mapping Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pe-set" class="md-nav__link">
    <span class="md-ellipsis">
      PE Set
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#summary-of-notation" class="md-nav__link">
    <span class="md-ellipsis">
      Summary of Notation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tiling-strategy-and-loop-ordering" class="md-nav__link">
    <span class="md-ellipsis">
      Tiling Strategy and Loop Ordering
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#performance-metrics" class="md-nav__link">
    <span class="md-ellipsis">
      Performance Metrics
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    <span class="md-ellipsis">
      Summary
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#implementation-of-analytical-model" class="md-nav__link">
    <span class="md-ellipsis">
      Implementation of Analytical Model
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#integration-with-network-parser" class="md-nav__link">
    <span class="md-ellipsis">
      Integration with Network Parser
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lab-23-design-space-exploration-dse" class="md-nav__link">
    <span class="md-ellipsis">
      Lab 2.3 - Design Space Exploration (DSE)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Lab 2.3 - Design Space Exploration (DSE)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#roofline-model" class="md-nav__link">
    <span class="md-ellipsis">
      Roofline Model
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mapping-parameter-search" class="md-nav__link">
    <span class="md-ellipsis">
      Mapping Parameter Search
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hardware-parameter-search" class="md-nav__link">
    <span class="md-ellipsis">
      Hardware Parameter Search
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#practice" class="md-nav__link">
    <span class="md-ellipsis">
      Practice
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Practice">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    <span class="md-ellipsis">
      Prerequisites
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1-workload-analysis" class="md-nav__link">
    <span class="md-ellipsis">
      1. Workload Analysis
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-network-parser" class="md-nav__link">
    <span class="md-ellipsis">
      2. Network Parser
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-analytical-model" class="md-nav__link">
    <span class="md-ellipsis">
      3. Analytical Model
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-roofline-model" class="md-nav__link">
    <span class="md-ellipsis">
      4. Roofline Model
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-design-space-exploration" class="md-nav__link">
    <span class="md-ellipsis">
      5. Design Space Exploration
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="lab-2-performance-modeling">Lab 2 - Performance Modeling</h1>
<h2 id="overview">Overview</h2>
<p>In this lab, we will perform workload analysis based on the model architecture from Lab 1, develop an analytical model to predict system performance, and investigate the optimal software and hardware configuration.</p>
<h2 id="lab-21-workload-analysis-and-network-parsing">Lab 2.1 - Workload Analysis and Network Parsing</h2>
<p>When implementing an AI accelerator, Workload Analysis and Network Parsing are critical steps, as they help designers understand the requirements of deep learning models and design efficient hardware architectures accordingly.</p>
<p>In this lab, students are required to implement Network Parsing for PyTorch and ONNX models, transforming them into a format predefined by TAs for further analysis.</p>
<h3 id="workload-analysis-to-identify-the-performance-bottleneck">Workload Analysis to Identify the Performance Bottleneck</h3>
<p>The <strong>purpose of workload analysis</strong> is to understand the computational requirements and characteristics of the target application, in order to <strong>guide architecture design</strong>. The main task of this phase is to <strong>analyze the workload</strong> that the accelerator needs to execute, ensuring that the designed architecture aligns with the characteristics of the target application, and avoids designing hardware that is either unsuitable or over-engineered.</p>
<p>In this phase, we will...</p>
<ul>
<li>Decide which computational patterns the AI accelerator should focus on, such as Conv acceleration or GEMM acceleration.</li>
<li>Determine the architecture design, such as using systolic arrays or vector extensions, etc.</li>
<li>Evaluating the memory architecture requirements, such as whether SRAM cache is needed or if there are constraints related to DRAM access.</li>
</ul>
<h4 id="ratio-of-different-operations">Ratio of Different Operations</h4>
<p>Next, we take VGG-8 (5 layers of 3x3 Conv2d + 3 layers of Linear) as an example, and we perform profiling on the model's inference with <a href="https://pytorch.org/tutorials/recipes/recipes/profiler_recipe.html">PyTorch Profiler</a>. Based on the CPU time, we list the top ten computations and obtain the following results:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="1:2"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio" /><input id="__tabbed_1_2" name="__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="__tabbed_1_1">Full-precision model</label><label for="__tabbed_1_2">Int8-quantized model</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-text highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>---------------------------------  ------------  ------------  ------------  ------------  ------------  ------------
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>                             Name    Self CPU %      Self CPU   CPU total %     CPU total  CPU time avg    # of Calls
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>---------------------------------  ------------  ------------  ------------  ------------  ------------  ------------
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>                  model_inference        12.90%     763.821us       100.00%       5.920ms       5.920ms             1
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="hll">                     aten::conv2d         0.39%      22.854us        67.44%       3.993ms     798.517us             5
</span></span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>                aten::convolution         0.89%      52.872us        67.05%       3.970ms     793.947us             5
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>               aten::_convolution         0.77%      45.697us        66.16%       3.917ms     783.372us             5
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>                aten::thnn_conv2d         0.14%       8.547us        38.52%       2.281ms     570.170us             4
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a>       aten::_slow_conv2d_forward        34.62%       2.049ms        38.38%       2.272ms     568.034us             4
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a>         aten::mkldnn_convolution        26.46%       1.566ms        26.69%       1.580ms       1.580ms             1
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a>                 aten::batch_norm         0.19%      11.092us         6.30%     373.078us      74.616us             5
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a>     aten::_batch_norm_impl_index         0.31%      18.232us         6.11%     361.986us      72.397us             5
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a>          aten::native_batch_norm         5.10%     301.772us         5.74%     339.836us      67.967us             5
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a>---------------------------------  ------------  ------------  ------------  ------------  ------------  ------------
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a>Self CPU time total: 5.920ms
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-text highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>---------------------------------  ------------  ------------  ------------  ------------  ------------  ------------
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>                             Name    Self CPU %      Self CPU   CPU total %     CPU total  CPU time avg    # of Calls
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>---------------------------------  ------------  ------------  ------------  ------------  ------------  ------------
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>                  model_inference        30.99%     864.312us       100.00%       2.789ms       2.789ms             1
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="hll">           quantized::conv2d_relu        44.15%       1.231ms        46.34%       1.292ms     258.446us             5
</span></span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a>           quantized::linear_relu        10.34%     288.334us        10.90%     303.885us     151.943us             2
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a>                 aten::max_pool2d         0.23%       6.332us         4.05%     112.968us      37.656us             3
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a>       aten::quantized_max_pool2d         3.57%      99.674us         3.82%     106.636us      35.545us             3
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a>                quantized::linear         3.43%      95.745us         3.61%     100.594us     100.594us             1
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a>        aten::quantize_per_tensor         2.06%      57.541us         2.06%      57.541us      57.541us             1
</span><span id="__span-1-11"><a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a>    aten::_empty_affine_quantized         1.48%      41.339us         1.48%      41.339us       3.180us            13
</span><span id="__span-1-12"><a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a>                      aten::clone         1.12%      31.332us         1.34%      37.233us      18.617us             2
</span><span id="__span-1-13"><a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a>                    aten::flatten         0.47%      13.105us         1.29%      35.889us      35.889us             1
</span><span id="__span-1-14"><a id="__codelineno-1-14" name="__codelineno-1-14" href="#__codelineno-1-14"></a>---------------------------------  ------------  ------------  ------------  ------------  ------------  ------------
</span><span id="__span-1-15"><a id="__codelineno-1-15" name="__codelineno-1-15" href="#__codelineno-1-15"></a>Self CPU time total: 2.789ms
</span></code></pre></div>
</div>
</div>
</div>
<p>It can be observed that in the <strong>full-precision model</strong>, Conv2d accounts for more than <strong>60%</strong> of the computation time, while in the <strong>quantized model</strong>, Conv2d still takes up over <strong>40%</strong> of the CPU time. BatchNorm, Linear, and MaxPool consume relatively smaller portions of the time and are not the main computation bottlenecks. Based on this, we determined that the system design should focus on accelerating the convolutional layer (including Conv2d, BatchNorm, ReLU, and MaxPool) as the primary target.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>If you have designed your own model architecture in Lab 1, you can also try running the above analysis and see what results you get.</p>
</div>
<p>Common accelerators used for Conv2d have the following architectures:</p>
<ul>
<li>Systolic array (e.g. Google TPU)</li>
<li>Eyeriss</li>
<li>NVDLA</li>
</ul>
<p>In the following Labs, we will design the accelerator based on the Eyeriss architecture. Below is the system architecture diagram from the original Eyeriss paper.</p>
<p><img alt="eyeriss-architecture" src="../../assets/images/Byzd4qOc1x.png" /></p>
<p>Since the implementation of the Lab is for educational purposes, we will not be implementing the entire Eyeriss accelerator but will simplify it in line with the same principles. Overall, we will have a row-stationary dataflow PE array to perform Conv2d and ReLU computations. The parameters for BatchNorm can be pre-fused into the Conv2d weights and biases (the derivation process can be referenced in the Lab 1 lecture notes), so there will be no dedicated hardware support for BatchNorm. Finally, MaxPool is a memory-bound operation. By further integrating its dataflow with the Conv2d dataflow, we can reduce DRAM access and speed up the overall computation process. Therefore, we will design a module responsible for performing the MaxPool operation before the activation is written back to DRAM.</p>
<p>In this assignment, you have to analyze your own model, and answer the questions in report.</p>
<h3 id="network-parsing-to-automate-the-analysis-workflow">Network Parsing to Automate the Analysis Workflow</h3>
<p>Since the hardware is designed by us and there are no existing performance evaluation tools to assist in the early stages of architecture design, we need to build our own performance model. This model will take a description of a model's computation as input and output the performance metrics that we care about.</p>
<p>To better integrate with the design of the model algorithm and automate the process, while bridging the differences between various model formats, we will develop a network parser. This parser will extract the parameters needed for performance evaluation from different model weight formats (such as PyTorch and ONNX). This will facilitate performance analysis in the subsequent stages, allowing the decoupling of performance modeling and AI model design.</p>
<h4 id="defining-layer-information-class">Defining Layer Information Class</h4>
<p>First, we need to define the parameters required for the operators supported by the accelerator.</p>
<p>In the <code>layer_info.py</code>, we provide a common interface through the <code>ShapeParam</code> to handle different shape-related parameters.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">ShapeParam</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert the object&#39;s attributes to a dictionary.&quot;&quot;&quot;</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>        <span class="k">return</span> <span class="n">asdict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a>    <span class="nd">@classmethod</span>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">from_dict</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create an instance of the class from a dictionary.&quot;&quot;&quot;</span>
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a>        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="o">**</span><span class="n">data</span><span class="p">)</span>
</span></code></pre></div>
<p><code>ShapeParam</code> is an abstract base class (ABC), which serves as the foundation for all shape parameter types. It provides two methods:
* <code>to_dict(self)</code>: Converts the object's attributes into a dictionary. It uses <code>dataclasses.asdict()</code> to automatically convert all the fields of the dataclass into a dictionary format.
* <code>from_dict(cls, data: dict)</code>: A class method that takes a dictionary and creates an instance of the class by unpacking the dictionary into the class constructor <code>(cls(**data))</code>.</p>
<p>According to the original paper, the parameters for Conv2d are as follows:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="k">class</span><span class="w"> </span><span class="nc">Conv2DShapeParam</span><span class="p">(</span><span class="n">ShapeParam</span><span class="p">):</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Follow the notation in the Eyeriss paper&quot;&quot;&quot;</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a>    <span class="n">N</span><span class="p">:</span> <span class="nb">int</span>  <span class="c1"># batch size</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a>    <span class="n">H</span><span class="p">:</span> <span class="nb">int</span>  <span class="c1"># input height</span>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a>    <span class="n">W</span><span class="p">:</span> <span class="nb">int</span>  <span class="c1"># input width</span>
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a>    <span class="n">R</span><span class="p">:</span> <span class="nb">int</span>  <span class="c1"># filter height</span>
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a>    <span class="n">S</span><span class="p">:</span> <span class="nb">int</span>  <span class="c1"># filter width</span>
</span><span id="__span-3-9"><a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a>    <span class="n">E</span><span class="p">:</span> <span class="nb">int</span>  <span class="c1"># output height</span>
</span><span id="__span-3-10"><a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a>    <span class="n">F</span><span class="p">:</span> <span class="nb">int</span>  <span class="c1"># output width</span>
</span><span id="__span-3-11"><a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a>    <span class="n">C</span><span class="p">:</span> <span class="nb">int</span>  <span class="c1"># input channels</span>
</span><span id="__span-3-12"><a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a>    <span class="n">M</span><span class="p">:</span> <span class="nb">int</span>  <span class="c1"># output channels</span>
</span><span id="__span-3-13"><a id="__codelineno-3-13" name="__codelineno-3-13" href="#__codelineno-3-13"></a>    <span class="n">U</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># stride</span>
</span><span id="__span-3-14"><a id="__codelineno-3-14" name="__codelineno-3-14" href="#__codelineno-3-14"></a>    <span class="n">P</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># padding</span>
</span></code></pre></div>
<p>Besides inherited from <code>ShapeParam</code>, <code>Conv2DShapeParam</code> is also a frozen dataclass. The <code>@dataclass(frozen=True)</code> decorator automatically generates methods like <code>__init__</code>, <code>__repr__</code>, and <code>__eq__</code>, and the <code>frozen=True</code> option makes the dataclass immutable, meaning its attributes cannot be modified after initialization.</p>
<p>BatchNorm and ReLU can be directly fused into Conv2d, so there is no need to define them separately. MaxPool2d cannot be fused with Conv2d as an operator, but it needs to be integrated into the dataflow of our custom DLA. Therefore, we define the information for MaxPool2d as follows:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="k">class</span><span class="w"> </span><span class="nc">MaxPool2DShapeParam</span><span class="p">(</span><span class="n">ShapeParam</span><span class="p">):</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a>    <span class="n">N</span><span class="p">:</span> <span class="nb">int</span>  <span class="c1"># batch size</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a>    <span class="n">kernel_size</span><span class="p">:</span> <span class="nb">int</span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a>    <span class="n">stride</span><span class="p">:</span> <span class="nb">int</span>
</span></code></pre></div>
<p>Additionally, we define <code>LinearShapeParam</code> as a dataclass that represents the shape parameters for a fully connected (linear) layer. However, our Eyeriss DLA will not directly support Linear layers. Instead, we will demonstrate <strong>CPU fallback support</strong> for operators that are not natively supported by our custom hardware through compiler in lab5.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="k">class</span><span class="w"> </span><span class="nc">LinearShapeParam</span><span class="p">(</span><span class="n">ShapeParam</span><span class="p">):</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a>    <span class="n">N</span><span class="p">:</span> <span class="nb">int</span>  <span class="c1"># batch size</span>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a>    <span class="n">in_features</span><span class="p">:</span> <span class="nb">int</span>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a>    <span class="n">out_features</span><span class="p">:</span> <span class="nb">int</span>
</span></code></pre></div>
<p>Next, we will implement the network parser to extract the above information from the pre-trained model's weight files.</p>
<h4 id="parsing-pytorch-models">Parsing PyTorch Models</h4>
<p>To obtain the model's weight information, we can directly load the model and retrieve the weights. However, the activations are not stored in the PyTorch weight files, as they do not save the input and output activation sizes. These sizes can only be dynamically inferred during the model's computation process. Fortunately, PyTorch provides a built-in "hook" mechanism, which allows users to dynamically insert custom operations during the forward pass or backward pass. This enables us to capture and track the activation sizes during the computation.</p>
<p>With hooks, we can dynamically inspect or manipulate input and output tensors without modifying the model's structure. They are commonly used for model debugging and visualization.</p>
<p>There are several types of <strong>hooks</strong> in PyTorch:
1. Forward Hook
    * Used to obtain the inputs and outputs of each layer during the forward pass.
    * Triggered after the forward pass of a layer is completed.
2. Backward Hook
    * Used to obtain the gradient values of inputs and outputs for each layer during the backward pass.
    * Triggered after the backward pass of a layer is completed.
3. Gradient Hook
    * Used to obtain the gradient values of each tensor during the backward pass.
    * Triggered after each gradient computation is completed but before the gradient is updated to the <code>grad</code> attribute.</p>
<p>Here’s how we can use hook mechanism in PyTorch to capture activation sizes during the forward pass:</p>
<h5 id="step-1-instantiate-a-model">Step 1. Instantiate a Model</h5>
<p>First, we create a <code>SimpleModel</code> and instantiate it.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">torch</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">torch.nn</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">nn</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a><span class="k">class</span><span class="w"> </span><span class="nc">SimpleModel</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a>        <span class="nb">super</span><span class="p">(</span><span class="n">SimpleModel</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
</span><span id="__span-6-8"><a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">conv</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Conv2d</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</span><span id="__span-6-9"><a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">relu</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">()</span>
</span><span id="__span-6-10"><a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fc</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">16</span> <span class="o">*</span> <span class="mi">30</span> <span class="o">*</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
</span><span id="__span-6-11"><a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a>
</span><span id="__span-6-12"><a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
</span><span id="__span-6-13"><a id="__codelineno-6-13" name="__codelineno-6-13" href="#__codelineno-6-13"></a>        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conv</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="__span-6-14"><a id="__codelineno-6-14" name="__codelineno-6-14" href="#__codelineno-6-14"></a>        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">relu</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="__span-6-15"><a id="__codelineno-6-15" name="__codelineno-6-15" href="#__codelineno-6-15"></a>        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-6-16"><a id="__codelineno-6-16" name="__codelineno-6-16" href="#__codelineno-6-16"></a>        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fc</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="__span-6-17"><a id="__codelineno-6-17" name="__codelineno-6-17" href="#__codelineno-6-17"></a>        <span class="k">return</span> <span class="n">x</span>
</span><span id="__span-6-18"><a id="__codelineno-6-18" name="__codelineno-6-18" href="#__codelineno-6-18"></a>
</span><span id="__span-6-19"><a id="__codelineno-6-19" name="__codelineno-6-19" href="#__codelineno-6-19"></a>
</span><span id="__span-6-20"><a id="__codelineno-6-20" name="__codelineno-6-20" href="#__codelineno-6-20"></a><span class="n">model</span> <span class="o">=</span> <span class="n">SimpleModel</span><span class="p">()</span>
</span></code></pre></div>
<h5 id="step-2-define-forward-hook">Step 2. Define Forward Hook</h5>
<p>Next, we define the operation we want to insert, which must be defined as a function as the following prototype.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="n">hook</span><span class="p">(</span><span class="n">module</span><span class="p">:</span> <span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">,</span> <span class="n">inputs</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">output</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]</span>
</span></code></pre></div>
<p>In this example, <code>hook_fn</code> prints the basic information of the layer, and it will be triggered during the forward pass.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">hook_fn</span><span class="p">(</span><span class="n">module</span><span class="p">:</span> <span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">,</span> <span class="n">inputs</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">output</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Layer: </span><span class="si">{</span><span class="n">module</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Input Shape: </span><span class="si">{</span><span class="n">inputs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Output Shape: </span><span class="si">{</span><span class="n">output</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span></code></pre></div>
<h5 id="step-3-register-forward-hook">Step 3. Register Forward Hook</h5>
<p>Then, we need to register the hook we defined with the <code>register_forward_hook</code> method into the modules we want to observe. Every call of <code>register_forward_hook</code> will return a handle of the hook inserted. We collect them with a list <code>hooks</code>, and we will remove them from the modules later.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="c1"># Register the hook using register_forward_hook</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="n">hooks</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="k">for</span> <span class="n">module</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">modules</span><span class="p">():</span>
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a>    <span class="n">hooks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">module</span><span class="o">.</span><span class="n">register_forward_hook</span><span class="p">(</span><span class="n">hook_fn</span><span class="p">))</span>
</span></code></pre></div>
<h5 id="step-4-trigger-forward-pass">Step 4. Trigger Forward Pass</h5>
<p>Finally, we create a random input and pass it through the model, triggering the hook. During the model's execution, the hook for each layer will be triggered, thus executing <code>hook_fn</code>. After the forward pass, we can remove the hooks via the handles collected in <code>hooks</code>.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="c1"># Create a input tensor</span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="n">dummy_input</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">32</span><span class="p">)</span>
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a>
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a><span class="c1"># Perform the forward pass, triggering the hook</span>
</span><span id="__span-10-5"><a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a><span class="n">model</span><span class="p">(</span><span class="n">dummy_input</span><span class="p">)</span>
</span><span id="__span-10-6"><a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a>
</span><span id="__span-10-7"><a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a><span class="c1"># Remove the hooks to prevent them from being triggered on every forward pass</span>
</span><span id="__span-10-8"><a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a><span class="k">for</span> <span class="n">hook</span> <span class="ow">in</span> <span class="n">hooks</span><span class="p">:</span>
</span><span id="__span-10-9"><a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a>    <span class="n">hook</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
</span></code></pre></div>
<p>The above code will output:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a>Layer: Conv2d
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a>Input Shape: torch.Size([1, 3, 32, 32])
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a>Output Shape: torch.Size([1, 16, 30, 30])
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a>
</span><span id="__span-11-5"><a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a>Layer: ReLU
</span><span id="__span-11-6"><a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a>Input Shape: torch.Size([1, 16, 30, 30])
</span><span id="__span-11-7"><a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a>Output Shape: torch.Size([1, 16, 30, 30])
</span><span id="__span-11-8"><a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a>
</span><span id="__span-11-9"><a id="__codelineno-11-9" name="__codelineno-11-9" href="#__codelineno-11-9"></a>Layer: Linear
</span><span id="__span-11-10"><a id="__codelineno-11-10" name="__codelineno-11-10" href="#__codelineno-11-10"></a>Input Shape: torch.Size([1, 14400])
</span><span id="__span-11-11"><a id="__codelineno-11-11" name="__codelineno-11-11" href="#__codelineno-11-11"></a>Output Shape: torch.Size([1, 10])
</span><span id="__span-11-12"><a id="__codelineno-11-12" name="__codelineno-11-12" href="#__codelineno-11-12"></a>
</span><span id="__span-11-13"><a id="__codelineno-11-13" name="__codelineno-11-13" href="#__codelineno-11-13"></a>Layer: SimpleModel
</span><span id="__span-11-14"><a id="__codelineno-11-14" name="__codelineno-11-14" href="#__codelineno-11-14"></a>Input Shape: torch.Size([1, 3, 32, 32])
</span><span id="__span-11-15"><a id="__codelineno-11-15" name="__codelineno-11-15" href="#__codelineno-11-15"></a>Output Shape: torch.Size([1, 10])
</span></code></pre></div>
<p>In this assignment, please implement your own <code>hook_fn</code> to capture the information of each layer in your custom VGG model. Then, populate the information into the previously defined <code>Conv2DShapeParam</code> and <code>MaxPool2DShapeParam</code> accordingly.</p>
<h4 id="parsing-onnx-models">Parsing ONNX Models</h4>
<p>ONNX (Open Neural Network Exchange) is an <strong>open standard</strong> that allows models to be exchanged between different deep learning frameworks (such as PyTorch and TensorFlow) and run on various inference engines (such as ONNX Runtime and TensorRT).</p>
<h5 id="convert-pytorch-models-to-onnx">Convert PyTorch Models to ONNX</h5>
<div class="language-python highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">torch</span>
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">torch.onnx</span>
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a>
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a><span class="n">model</span> <span class="o">=</span> <span class="n">SimpleModel</span><span class="p">()</span>
</span><span id="__span-12-5"><a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a><span class="n">dummy_input</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">32</span><span class="p">)</span>
</span><span id="__span-12-6"><a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a><span class="n">torch</span><span class="o">.</span><span class="n">onnx</span><span class="o">.</span><span class="n">export</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">dummy_input</span><span class="p">,</span> <span class="s2">&quot;simple_model.onnx&quot;</span><span class="p">)</span>
</span></code></pre></div>
<h5 id="run-inference-with-onnx-runtime">Run Inference with ONNX Runtime</h5>
<div class="language-python highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">onnxruntime</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">ort</span>
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a><span class="n">session</span> <span class="o">=</span> <span class="n">ort</span><span class="o">.</span><span class="n">InferenceSession</span><span class="p">(</span><span class="s2">&quot;simple_model.onnx&quot;</span><span class="p">)</span>
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a><span class="n">result</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;input&quot;</span><span class="p">:</span> <span class="n">input_data</span><span class="p">})</span>
</span></code></pre></div>
<h5 id="visualize-onnx-models">Visualize ONNX Models</h5>
<p>An ONNX model can be visualized by using <a href="https://github.com/lutzroeder/netron">Netron</a>, and the result looks like this:</p>
<ul>
<li>full-precision model (FP32)
    <img alt="netron-fp32" src="../../assets/images/S1Y4IwOqye.png" /></li>
<li>quantized model (INT8)
    <img alt="netron-int8" src="../../assets/images/B1mLHDdq1g.png" /></li>
</ul>
<p>Students, try using Netron to visualize your own custom-designed model. Observe how the model architecture changes before and after quantization.</p>
<h5 id="parsing-onnx-models_1">Parsing ONNX Models</h5>
<p>ONNX cannot be used for training and requires the model to be trained in another framework first. Unlike PyTorch, ONNX stores the sizes of inputs and outputs.</p>
<p>During the process of parsing an ONNX model, using <code>shape_inference</code> helps us obtain tensor shape information.</p>
<h5 id="step-1-use-shape_inference-to-infer-shapes">Step 1. Use shape_inference to infer shapes</h5>
<div class="language-python highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">onnx</span>
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">onnx</span><span class="w"> </span><span class="kn">import</span> <span class="n">shape_inference</span>
</span><span id="__span-14-3"><a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a><span class="k">def</span><span class="w"> </span><span class="nf">_get_tensor_shape</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">onnx</span><span class="o">.</span><span class="n">ModelProto</span><span class="p">,</span> <span class="n">tensor_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-14-4"><a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a>    <span class="n">inferred_model</span> <span class="o">=</span> <span class="n">shape_inference</span><span class="o">.</span><span class="n">infer_shapes</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
</span></code></pre></div>
<h5 id="step-2-search-in-different-sections">Step 2. Search in different Sections</h5>
<div class="language-python highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a>    <span class="c1"># Search for the tensor with the given name</span>
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a>    <span class="k">for</span> <span class="n">value_info</span> <span class="ow">in</span> <span class="n">inferred_model</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">value_info</span><span class="p">:</span>
</span><span id="__span-15-3"><a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a>        <span class="k">if</span> <span class="n">value_info</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">tensor_name</span><span class="p">:</span>
</span><span id="__span-15-4"><a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a>            <span class="k">return</span> <span class="c1"># return shape</span>
</span><span id="__span-15-5"><a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a>
</span><span id="__span-15-6"><a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a>    <span class="c1"># If not found; search the model&#39;s inputs</span>
</span><span id="__span-15-7"><a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a>    <span class="k">for</span> <span class="n">input_info</span> <span class="ow">in</span> <span class="n">inferred_model</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">input</span><span class="p">:</span>
</span><span id="__span-15-8"><a id="__codelineno-15-8" name="__codelineno-15-8" href="#__codelineno-15-8"></a>        <span class="k">if</span> <span class="n">input_info</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">tensor_name</span><span class="p">:</span>
</span><span id="__span-15-9"><a id="__codelineno-15-9" name="__codelineno-15-9" href="#__codelineno-15-9"></a>            <span class="k">return</span> <span class="c1"># return shape</span>
</span><span id="__span-15-10"><a id="__codelineno-15-10" name="__codelineno-15-10" href="#__codelineno-15-10"></a>
</span><span id="__span-15-11"><a id="__codelineno-15-11" name="__codelineno-15-11" href="#__codelineno-15-11"></a>    <span class="c1"># If still not found; search the model&#39;s outputs</span>
</span><span id="__span-15-12"><a id="__codelineno-15-12" name="__codelineno-15-12" href="#__codelineno-15-12"></a>    <span class="k">for</span> <span class="n">output_info</span> <span class="ow">in</span> <span class="n">inferred_model</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">output</span><span class="p">:</span>
</span><span id="__span-15-13"><a id="__codelineno-15-13" name="__codelineno-15-13" href="#__codelineno-15-13"></a>        <span class="k">if</span> <span class="n">output_info</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">tensor_name</span><span class="p">:</span>
</span><span id="__span-15-14"><a id="__codelineno-15-14" name="__codelineno-15-14" href="#__codelineno-15-14"></a>            <span class="k">return</span> <span class="c1"># return shape</span>
</span></code></pre></div>
<p>In this assignment, please implement a network parser for the ONNX model. Extract the relevant information from the model and fill it into the previously defined Layer Info classes.</p>
<h2 id="lab-22-analytical-model-for-eyeriss-dla">Lab 2.2 - Analytical Model for Eyeriss DLA</h2>
<h3 id="introduction-to-performance-modeling">Introduction to Performance Modeling</h3>
<ul>
<li><strong>Analytical modeling</strong>: Analytical modeling use mathematical equations to describe the performance characteristics of a hardware system. This method is suitable for simpler designs, but as system complexity increases, model accuracy may become limited.</li>
<li><strong>Simulation-based modeling</strong>: Simulation provides a more accurate modeling method with simulation software to model the behavior of the system, especially useful for evaluating complex architectures.<ul>
<li>cycle-accurate simulation v.s. behavioral simulation</li>
<li>full-system simulation v.s. intruction-level simulation</li>
</ul>
</li>
<li><strong>Statistical modeling</strong>: Statistical modeling gathers performance data under different conditions and uses statistical methods to create predictive models. When sufficient data is available, this method can achieve reasonable accuracy, but it may require extensive data and computational resources.</li>
<li><strong>Machine learning-based modeling</strong>: With advances in machine learning, using machine learning for performance modeling has become an emerging approach. For example, regression models or neural networks can predict the performance of specific hardware designs. This method is highly flexible and suitable for handling highly complex architectures but requires a large amount of training data.</li>
</ul>
<p>In this section, we will develop an analytical model for Eyeriss architecture to predict the system performance, and investigate the optimal software and hardware mapping configuration.</p>
<h3 id="hardware-parameters">Hardware Parameters</h3>
<p>The ultimate goal of the analytical model is to determine which implementation method to adopt by calculating the performance that different hardware configurations can provide. In the DLA, factors such as the size of the PE array, the scratch pad memory size within the PE, the size of the global buffer, and the bus bandwidth all affect the final performance that the hardware can deliver. Below, we will define these parameters as the <code>EyerissHardwareParam</code> data class.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a><span class="k">class</span><span class="w"> </span><span class="nc">EyerissHardwareParam</span><span class="p">:</span>
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a>    <span class="n">pe_array_h</span><span class="p">:</span> <span class="nb">int</span>
</span><span id="__span-16-4"><a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a>    <span class="n">pe_array_w</span><span class="p">:</span> <span class="nb">int</span>
</span><span id="__span-16-5"><a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a>    <span class="n">ifmap_spad_size</span><span class="p">:</span> <span class="nb">int</span>
</span><span id="__span-16-6"><a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a>    <span class="n">filter_spad_size</span><span class="p">:</span> <span class="nb">int</span>
</span><span id="__span-16-7"><a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a>    <span class="n">psum_spad_size</span><span class="p">:</span> <span class="nb">int</span>
</span><span id="__span-16-8"><a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a>    <span class="n">glb_size</span><span class="p">:</span> <span class="nb">int</span>
</span><span id="__span-16-9"><a id="__codelineno-16-9" name="__codelineno-16-9" href="#__codelineno-16-9"></a>    <span class="n">bus_bw</span><span class="p">:</span> <span class="nb">int</span>
</span><span id="__span-16-10"><a id="__codelineno-16-10" name="__codelineno-16-10" href="#__codelineno-16-10"></a>    <span class="n">noc_bw</span><span class="p">:</span> <span class="nb">int</span>
</span></code></pre></div>
<h3 id="dataflow-mapping-parameters">Dataflow Mapping Parameters</h3>
<p>Eyeriss uses the row-stationary (RS) dataflow, which is defined by the following mapping parameters (see Table 2 in the paper). These parameters determine how the data is tiled, how it is mapped to the computational units on the hardware, and which are related to data reuse.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="nd">@dataclass</span>
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a><span class="k">class</span><span class="w"> </span><span class="nc">EyerissMappingParam</span><span class="p">:</span>
</span><span id="__span-17-3"><a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a>    <span class="n">m</span><span class="p">:</span> <span class="nb">int</span>  <span class="c1"># number of ofmap channels stored in global buffer</span>
</span><span id="__span-17-4"><a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a>    <span class="n">n</span><span class="p">:</span> <span class="nb">int</span>  <span class="c1"># number of ofmaps/ifmaps used in a processing pass</span>
</span><span id="__span-17-5"><a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a>    <span class="n">e</span><span class="p">:</span> <span class="nb">int</span>  <span class="c1"># width of the PE set (strip-mined if nessary)</span>
</span><span id="__span-17-6"><a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a>    <span class="n">p</span><span class="p">:</span> <span class="nb">int</span>  <span class="c1"># number of filters processed by a PE set</span>
</span><span id="__span-17-7"><a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a>    <span class="n">q</span><span class="p">:</span> <span class="nb">int</span>  <span class="c1"># number of ifmap/filter channels processed by a PE set</span>
</span><span id="__span-17-8"><a id="__codelineno-17-8" name="__codelineno-17-8" href="#__codelineno-17-8"></a>    <span class="n">r</span><span class="p">:</span> <span class="nb">int</span>  <span class="c1"># number of PE sets for different ifmap/filter channels</span>
</span><span id="__span-17-9"><a id="__codelineno-17-9" name="__codelineno-17-9" href="#__codelineno-17-9"></a>    <span class="n">t</span><span class="p">:</span> <span class="nb">int</span>  <span class="c1"># number of PE sets for different filters</span>
</span></code></pre></div>
<h3 id="pe-set">PE Set</h3>
<p>Eyeriss employs a 2D array of PEs, each responsible for performing MAC operations. The PE array in Eyeriss is configurable. Thus, we can further partition the entire PE array into several PE sets to improve PE utilization rate and data reuse. A PE set is a logical grouping of PEs that are assigned to process a specific part of the convolution operation. since we apply the row-stationary dataflow, the height of a PE set is determined by the filter height R.</p>
<p>For instance, we have a 6*8 PE array:</p>
<p><img alt="image" src="../../assets/images/r1usPAqi1l.png" /></p>
<p>We assume that the height of the filters is 3; then, we can separate the PE set like this:</p>
<p><img alt="image" src="../../assets/images/H1Bjd05jJx.png" /></p>
<p>There're plenty of methods to assign these PE sets.
In this example, e for a PE set is 4, which means that one PE set can process 4 rows of ofmap at a time. The values of m, n, p, and q are constrained by the on-chip memory (GLB or Spad).
Notice that <strong>r × t must equal 4</strong> in this example. Either different PE sets process different channels, or different PE sets process different filters. There is no other choice.</p>
<h3 id="summary-of-notation">Summary of Notation</h3>
<h4 id="conv2d-shape-parameter">Conv2D Shape Parameter</h4>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>N</td>
<td>batch size</td>
</tr>
<tr>
<td>H/W</td>
<td>input height/width</td>
</tr>
<tr>
<td>R/S</td>
<td>filter height/width</td>
</tr>
<tr>
<td>E/F</td>
<td>output height/width</td>
</tr>
<tr>
<td>C</td>
<td>input channels</td>
</tr>
<tr>
<td>M</td>
<td>output channels</td>
</tr>
<tr>
<td>U</td>
<td>stride</td>
</tr>
<tr>
<td>P</td>
<td>padding</td>
</tr>
</tbody>
</table>
<h4 id="rs-dataflow-mapping-parameter">RS Dataflow Mapping Parameter</h4>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>m</td>
<td>number of ofmap channels stored in the global buffer</td>
</tr>
<tr>
<td>n</td>
<td>number of ofmaps/ifmaps used in a processing pass</td>
</tr>
<tr>
<td>e</td>
<td>width of the PE set (strip-mined if nessary)</td>
</tr>
<tr>
<td>p</td>
<td>number of filters processed by a PE set</td>
</tr>
<tr>
<td>q</td>
<td>number of ifmap/filter channels processed by a PE set</td>
</tr>
<tr>
<td>r</td>
<td>number of PE sets for different ifmap/filter channels</td>
</tr>
<tr>
<td>t</td>
<td>number of PE sets for different filters</td>
</tr>
</tbody>
</table>
<h3 id="tiling-strategy-and-loop-ordering">Tiling Strategy and Loop Ordering</h3>
<h4 id="visualization-for-conv2d-tiling">Visualization for Conv2D Tiling</h4>
<p>Below, we map a Conv2d operator to the Eyeriss DLA and label the Conv2d shape parameters and mapping parameters using the notation from the paper.
We present the execution of Eyeriss tiling in each processing pass using a PPT to illustrate how data is processed in a single pass. The light blue-gray blocks represent the amount of data that can be processed in a single processing pass.</p>
<ul>
<li>Youtube Video</li>
</ul>
<iframe width="800" height="450" src="https://www.youtube.com/embed/MwsqeRTenXs" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>

<ul>
<li>Slides</li>
</ul>
<iframe class="speakerdeck-iframe" frameborder="0" src="https://speakerdeck.com/player/164d03c61f9848ddb463f0010bff57cf?slide=1" title="AOC2025_-_Lab2tile.pdf" allowfullscreen="true" style="border: 0px; background: padding-box padding-box rgba(0, 0, 0, 0.1); margin: 0px; padding: 0px; border-radius: 6px; box-shadow: rgba(0, 0, 0, 0.2) 0px 5px 40px; width: 100%; height: auto; aspect-ratio: 560 / 315;" data-ratio="1.7777777777777777"></iframe>

<h4 id="loop-nests-representation-for-conv2d-tiling">Loop Nests Representation for Conv2D Tiling</h4>
<p>Below is the representation of Conv2d tiling using loop nests, and how it is mapped to the PE array. We will explain each part step by step.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="n">uint8</span> <span class="n">I</span><span class="p">[</span><span class="n">N</span><span class="p">][</span><span class="n">C</span><span class="p">][</span><span class="n">H</span><span class="p">][</span><span class="n">W</span><span class="p">]</span>    <span class="c1"># input activations</span>
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a><span class="n">int8</span>  <span class="n">W</span><span class="p">[</span><span class="n">M</span><span class="p">][</span><span class="n">C</span><span class="p">][</span><span class="n">R</span><span class="p">][</span><span class="n">S</span><span class="p">]</span>    <span class="c1"># filter weights</span>
</span><span id="__span-18-3"><a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a><span class="n">int32</span> <span class="n">B</span><span class="p">[</span><span class="n">M</span><span class="p">]</span>             <span class="c1"># bias</span>
</span><span id="__span-18-4"><a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a><span class="n">uint8</span> <span class="n">O</span><span class="p">[</span><span class="n">N</span><span class="p">][</span><span class="n">M</span><span class="p">][</span><span class="n">E</span><span class="p">][</span><span class="n">F</span><span class="p">]</span>    <span class="c1"># output activations</span>
</span><span id="__span-18-5"><a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a>
</span><span id="__span-18-6"><a id="__codelineno-18-6" name="__codelineno-18-6" href="#__codelineno-18-6"></a><span class="k">for</span> <span class="n">m_base</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="n">m</span><span class="p">):</span>
</span><span id="__span-18-7"><a id="__codelineno-18-7" name="__codelineno-18-7" href="#__codelineno-18-7"></a><span class="k">for</span> <span class="n">e_base</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
</span><span id="__span-18-8"><a id="__codelineno-18-8" name="__codelineno-18-8" href="#__codelineno-18-8"></a><span class="k">for</span> <span class="n">n_base</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
</span><span id="__span-18-9"><a id="__codelineno-18-9" name="__codelineno-18-9" href="#__codelineno-18-9"></a><span class="k">for</span> <span class="n">c_base</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">q</span><span class="o">*</span><span class="n">r</span><span class="p">):</span>
</span><span id="__span-18-10"><a id="__codelineno-18-10" name="__codelineno-18-10" href="#__codelineno-18-10"></a><span class="k">for</span> <span class="n">m_tile</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">p</span><span class="o">*</span><span class="n">t</span><span class="p">):</span>
</span><span id="__span-18-11"><a id="__codelineno-18-11" name="__codelineno-18-11" href="#__codelineno-18-11"></a>    <span class="c1"># move data from DRAM to GLB</span>
</span><span id="__span-18-12"><a id="__codelineno-18-12" name="__codelineno-18-12" href="#__codelineno-18-12"></a>    <span class="n">dma</span><span class="p">(</span><span class="n">DRAM_TO_GLB</span><span class="p">,</span> <span class="n">I</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">n</span><span class="o">*</span><span class="p">(</span><span class="n">q</span><span class="o">*</span><span class="n">r</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">U</span><span class="o">*</span><span class="p">(</span><span class="n">e</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">R</span><span class="p">)</span><span class="o">*</span><span class="n">W</span><span class="p">)</span>
</span><span id="__span-18-13"><a id="__codelineno-18-13" name="__codelineno-18-13" href="#__codelineno-18-13"></a>    <span class="n">dma</span><span class="p">(</span><span class="n">DRAM_TO_GLB</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">p</span><span class="o">*</span><span class="n">t</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">q</span><span class="o">*</span><span class="n">r</span><span class="p">)</span><span class="o">*</span><span class="n">R</span><span class="o">*</span><span class="n">S</span><span class="p">)</span>
</span><span id="__span-18-14"><a id="__codelineno-18-14" name="__codelineno-18-14" href="#__codelineno-18-14"></a>    <span class="n">dma</span><span class="p">(</span><span class="n">DRAM_TO_GLB</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">p</span><span class="o">*</span><span class="n">t</span><span class="p">))</span>
</span><span id="__span-18-15"><a id="__codelineno-18-15" name="__codelineno-18-15" href="#__codelineno-18-15"></a>
</span><span id="__span-18-16"><a id="__codelineno-18-16" name="__codelineno-18-16" href="#__codelineno-18-16"></a>    <span class="c1"># processing pass in the PE array, each PE calculate a row of output</span>
</span><span id="__span-18-17"><a id="__codelineno-18-17" name="__codelineno-18-17" href="#__codelineno-18-17"></a>
</span><span id="__span-18-18"><a id="__codelineno-18-18" name="__codelineno-18-18" href="#__codelineno-18-18"></a>    <span class="c1"># PE sets in the PE array</span>
</span><span id="__span-18-19"><a id="__codelineno-18-19" name="__codelineno-18-19" href="#__codelineno-18-19"></a>    <span class="n">parallel_for</span> <span class="n">c_subtile</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">q</span><span class="o">*</span><span class="n">r</span><span class="p">,</span> <span class="n">q</span><span class="p">):</span>
</span><span id="__span-18-20"><a id="__codelineno-18-20" name="__codelineno-18-20" href="#__codelineno-18-20"></a>    <span class="n">parallel_for</span> <span class="n">m_subtile</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">p</span><span class="o">*</span><span class="n">t</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
</span><span id="__span-18-21"><a id="__codelineno-18-21" name="__codelineno-18-21" href="#__codelineno-18-21"></a>
</span><span id="__span-18-22"><a id="__codelineno-18-22" name="__codelineno-18-22" href="#__codelineno-18-22"></a>    <span class="c1"># PEs within a PE set</span>
</span><span id="__span-18-23"><a id="__codelineno-18-23" name="__codelineno-18-23" href="#__codelineno-18-23"></a>    <span class="n">parallel_for</span> <span class="n">r_idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">R</span><span class="p">):</span>
</span><span id="__span-18-24"><a id="__codelineno-18-24" name="__codelineno-18-24" href="#__codelineno-18-24"></a>    <span class="n">parallel_for</span> <span class="n">e_offset</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
</span><span id="__span-18-25"><a id="__codelineno-18-25" name="__codelineno-18-25" href="#__codelineno-18-25"></a>
</span><span id="__span-18-26"><a id="__codelineno-18-26" name="__codelineno-18-26" href="#__codelineno-18-26"></a>        <span class="c1"># in a single PE</span>
</span><span id="__span-18-27"><a id="__codelineno-18-27" name="__codelineno-18-27" href="#__codelineno-18-27"></a>        <span class="k">for</span> <span class="n">n_offset</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
</span><span id="__span-18-28"><a id="__codelineno-18-28" name="__codelineno-18-28" href="#__codelineno-18-28"></a>        <span class="k">for</span> <span class="n">c_offset</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">q</span><span class="p">):</span>
</span><span id="__span-18-29"><a id="__codelineno-18-29" name="__codelineno-18-29" href="#__codelineno-18-29"></a>        <span class="k">for</span> <span class="n">m_offset</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
</span><span id="__span-18-30"><a id="__codelineno-18-30" name="__codelineno-18-30" href="#__codelineno-18-30"></a>        <span class="k">for</span> <span class="n">f_idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">F</span><span class="p">):</span>
</span><span id="__span-18-31"><a id="__codelineno-18-31" name="__codelineno-18-31" href="#__codelineno-18-31"></a>            <span class="n">n_idx</span> <span class="o">=</span> <span class="n">n_base</span> <span class="o">+</span> <span class="n">n_offset</span>
</span><span id="__span-18-32"><a id="__codelineno-18-32" name="__codelineno-18-32" href="#__codelineno-18-32"></a>            <span class="n">m_idx</span> <span class="o">=</span> <span class="n">m_base</span> <span class="o">+</span> <span class="n">m_tile</span> <span class="o">+</span> <span class="n">m_subtile</span> <span class="o">+</span> <span class="n">m_offset</span>
</span><span id="__span-18-33"><a id="__codelineno-18-33" name="__codelineno-18-33" href="#__codelineno-18-33"></a>            <span class="n">e_idx</span> <span class="o">=</span> <span class="n">e_base</span> <span class="o">+</span> <span class="n">e_offset</span>
</span><span id="__span-18-34"><a id="__codelineno-18-34" name="__codelineno-18-34" href="#__codelineno-18-34"></a>            <span class="n">c_idx</span> <span class="o">=</span> <span class="n">c_base</span> <span class="o">+</span> <span class="n">c_subtile</span> <span class="o">+</span> <span class="n">c_offset</span>
</span><span id="__span-18-35"><a id="__codelineno-18-35" name="__codelineno-18-35" href="#__codelineno-18-35"></a>            <span class="n">h_idx</span> <span class="o">=</span> <span class="n">e_idx</span>
</span><span id="__span-18-36"><a id="__codelineno-18-36" name="__codelineno-18-36" href="#__codelineno-18-36"></a>            <span class="n">w_idx</span> <span class="o">=</span> <span class="n">f_idx</span>
</span><span id="__span-18-37"><a id="__codelineno-18-37" name="__codelineno-18-37" href="#__codelineno-18-37"></a>
</span><span id="__span-18-38"><a id="__codelineno-18-38" name="__codelineno-18-38" href="#__codelineno-18-38"></a>            <span class="k">if</span> <span class="n">c_base</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="__span-18-39"><a id="__codelineno-18-39" name="__codelineno-18-39" href="#__codelineno-18-39"></a>                <span class="n">psum</span> <span class="o">=</span> <span class="n">B</span><span class="p">[</span><span class="n">m_idx</span><span class="p">]</span>
</span><span id="__span-18-40"><a id="__codelineno-18-40" name="__codelineno-18-40" href="#__codelineno-18-40"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-18-41"><a id="__codelineno-18-41" name="__codelineno-18-41" href="#__codelineno-18-41"></a>                <span class="n">psum</span> <span class="o">+=</span> \
</span><span id="__span-18-42"><a id="__codelineno-18-42" name="__codelineno-18-42" href="#__codelineno-18-42"></a>                    <span class="n">I</span><span class="p">[</span><span class="n">n_idx</span><span class="p">][</span><span class="n">c_idx</span><span class="p">][</span><span class="n">h_idx</span><span class="p">][</span><span class="n">w_idx</span><span class="p">:</span><span class="n">w_idx</span><span class="o">+</span><span class="n">S</span><span class="p">]</span> <span class="o">*</span> \
</span><span id="__span-18-43"><a id="__codelineno-18-43" name="__codelineno-18-43" href="#__codelineno-18-43"></a>                    <span class="n">W</span><span class="p">[</span><span class="n">m_idx</span><span class="p">][</span><span class="n">c_idx</span><span class="p">][</span><span class="n">r_idx</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="n">S</span><span class="p">]</span>
</span><span id="__span-18-44"><a id="__codelineno-18-44" name="__codelineno-18-44" href="#__codelineno-18-44"></a>
</span><span id="__span-18-45"><a id="__codelineno-18-45" name="__codelineno-18-45" href="#__codelineno-18-45"></a>            <span class="n">O</span><span class="p">[</span><span class="n">n_idx</span><span class="p">][</span><span class="n">m_idx</span><span class="p">][</span><span class="n">e_idx</span><span class="p">][</span><span class="n">f_idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">psum</span>
</span><span id="__span-18-46"><a id="__codelineno-18-46" name="__codelineno-18-46" href="#__codelineno-18-46"></a>
</span><span id="__span-18-47"><a id="__codelineno-18-47" name="__codelineno-18-47" href="#__codelineno-18-47"></a>    <span class="c1"># move data from GLB to DRAM</span>
</span><span id="__span-18-48"><a id="__codelineno-18-48" name="__codelineno-18-48" href="#__codelineno-18-48"></a>    <span class="n">dma</span><span class="p">(</span><span class="n">GLB_TO_DRAM</span><span class="p">,</span> <span class="n">O</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">n</span><span class="o">*</span><span class="n">m</span><span class="o">*</span><span class="n">e</span><span class="o">*</span><span class="n">F</span><span class="p">)</span>
</span></code></pre></div>
<p>The above pseudocode contains two types of for loops. The <code>for</code> loop represents a "temporal for," where the iterations correspond to the computation of different data at different time points by a single computational unit. The other loop, <code>parallel_for</code>, represents a "spatial for," where at the same time point, different data is assigned to different computational units for processing.</p>
<p>Different output rows (indexed by <code>e_offset</code>) will be distributed across different PEs for computation in a single processing pass, as represented below:</p>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-19-16">16</a></span>
<span class="normal"><a href="#__codelineno-19-17">17</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-19-16"><a id="__codelineno-19-16" name="__codelineno-19-16"></a><span class="c1"># processing pass in the PE array, each PE calculate a row of output</span>
</span><span id="__span-19-17"><a id="__codelineno-19-17" name="__codelineno-19-17"></a><span class="n">parallel_for</span> <span class="n">e_offset</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
</span></code></pre></div></td></tr></table></div>
<p>In a single processing pass, each PE is responsible for computing one row. It will first iterate <code>F</code> times along the input/output width dimension, then iterate <code>p * t</code> elements along the output channel dimension, followed by iterating <code>q * r</code> elements along the input/filter channel dimension. Finally, it will iterate over the input/output batch size dimension, where we are currently assuming <span class="arithmatex">\(N=n=1\)</span>.</p>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-20-19">19</a></span>
<span class="normal"><a href="#__codelineno-20-20">20</a></span>
<span class="normal"><a href="#__codelineno-20-21">21</a></span>
<span class="normal"><a href="#__codelineno-20-22">22</a></span>
<span class="normal"><a href="#__codelineno-20-23">23</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-20-19"><a id="__codelineno-20-19" name="__codelineno-20-19"></a><span class="c1"># in a single PE</span>
</span><span id="__span-20-20"><a id="__codelineno-20-20" name="__codelineno-20-20"></a><span class="k">for</span> <span class="n">n_offset</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
</span><span id="__span-20-21"><a id="__codelineno-20-21" name="__codelineno-20-21"></a><span class="k">for</span> <span class="n">c_offset</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">q</span><span class="o">*</span><span class="n">r</span><span class="p">):</span>
</span><span id="__span-20-22"><a id="__codelineno-20-22" name="__codelineno-20-22"></a><span class="k">for</span> <span class="n">m_offset</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">p</span><span class="o">*</span><span class="n">t</span><span class="p">):</span>
</span><span id="__span-20-23"><a id="__codelineno-20-23" name="__codelineno-20-23"></a><span class="k">for</span> <span class="n">f_idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">F</span><span class="p">):</span>
</span></code></pre></div></td></tr></table></div>
<p>Each PE is responsible for performing channel-wise partial sum accumulation. Therefore, when <code>c_base == 0</code>, the bias can be pre-loaded from the GLB (Global Buffer) into the PE. For other cases, the product of the input and weight elements is accumulated into the partial sum (psum) scratch pad memory.</p>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-21-31">31</a></span>
<span class="normal"><a href="#__codelineno-21-32">32</a></span>
<span class="normal"><a href="#__codelineno-21-33">33</a></span>
<span class="normal"><a href="#__codelineno-21-34">34</a></span>
<span class="normal"><a href="#__codelineno-21-35">35</a></span>
<span class="normal"><a href="#__codelineno-21-36">36</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-21-31"><a id="__codelineno-21-31" name="__codelineno-21-31"></a><span class="k">if</span> <span class="n">c_base</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="__span-21-32"><a id="__codelineno-21-32" name="__codelineno-21-32"></a>    <span class="n">psum</span> <span class="o">=</span> <span class="n">B</span><span class="p">[</span><span class="n">m_idx</span><span class="p">]</span>
</span><span id="__span-21-33"><a id="__codelineno-21-33" name="__codelineno-21-33"></a><span class="k">else</span><span class="p">:</span>
</span><span id="__span-21-34"><a id="__codelineno-21-34" name="__codelineno-21-34"></a>    <span class="n">psum</span> <span class="o">+=</span> \
</span><span id="__span-21-35"><a id="__codelineno-21-35" name="__codelineno-21-35"></a>        <span class="n">I</span><span class="p">[</span><span class="n">n_idx</span><span class="p">][</span><span class="n">c_idx</span><span class="p">][</span><span class="n">h_idx</span><span class="p">][</span><span class="n">w_idx</span><span class="p">:</span><span class="n">w_idx</span><span class="o">+</span><span class="n">S</span><span class="p">]</span> <span class="o">*</span> \
</span><span id="__span-21-36"><a id="__codelineno-21-36" name="__codelineno-21-36"></a>        <span class="n">W</span><span class="p">[</span><span class="n">m_idx</span><span class="p">][</span><span class="n">c_idx</span><span class="p">][</span><span class="n">r_idx</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="n">S</span><span class="p">]</span>
</span></code></pre></div></td></tr></table></div>
<h3 id="performance-metrics">Performance Metrics</h3>
<p>After understanding how Eyeriss performs the Conv2d operation, the next step is to evaluate the system's performance under different parameter configurations. Below, we list several performance metrics:</p>
<ul>
<li>memory related<ul>
<li><a href="#glb-usage">GLB Usage</a></li>
<li><a href="#glb-access-data-transfer-between-glb-and-spads">GLB Access</a></li>
<li><a href="#dram-access-data-transfer-between-dram-and-glb">DRAM Access</a></li>
</ul>
</li>
<li>compute related<ul>
<li><a href="#macs">MACs</a></li>
<li><a href="#latency">Latency</a></li>
</ul>
</li>
<li>energy related<ul>
<li><a href="#power-and-energy-consumption">Power Consumption</a></li>
</ul>
</li>
</ul>
<h4 id="glb-usage">GLB Usage</h4>
<p>The size required for the GLB (Global Buffer) depends on how much data is processed in a single processing pass, including the input feature map (8 bits per element), filter (8 bits per element), bias (32 bits per element), and partial sum (32 bits per element).</p>
<p>In the upcoming lab, zero skipping is expected to be used when fetching the ifmap, so there is no need to consider the storage of padding.</p>
<p>Below, we take the input feature map (ifmap) as an example:</p>
<div class="arithmatex">\[
\text{GLB usage of ifmap} = n \times qr \times (U(e-1) + R) \times W \times 1 \text{byte}
\]</div>
<h4 id="dram-access-data-transfer-between-dram-and-glb">DRAM Access (Data Transfer between DRAM and GLB)</h4>
<p>The data used in a single processing pass is loaded from DRAM to the GLB once and written back from the GLB to DRAM once. Therefore, by dividing the total size of the entire layer by the amount of data processed in each processing pass, you can determine how many times DRAM needs to be accessed.</p>
<p>Below, we take the input feature map (ifmap) as an example:</p>
<div class="arithmatex">\[
\text{DRAM reads for ifmap} =
\overbrace{
    \left\lceil\frac{M}{m}\right\rceil
}^\text{refetch DRAM} \times
\overbrace{
    \left\lceil\frac{E}{e}\right\rceil \times
    \left\lceil\frac{N}{n}\right\rceil \times
    \left\lceil\frac{C}{qr}\right\rceil
}^\text{num of tiles} \times
\overbrace{
    n \times qr \times (U(e-1) + R) \times W \times 1 \text{byte}
}^\text{tile size}
\]</div>
<h4 id="glb-access-data-transfer-between-glb-and-spads">GLB Access (Data Transfer between GLB and Spads)</h4>
<p>Below, we take the input feature map (ifmap) as an example:</p>
<div class="arithmatex">\[
\text{GLB reads for ifmap} =
\overbrace{
    \left\lceil\frac{M}{m}\right\rceil
}^\text{refetch DRAM} \times
\overbrace{
    \left\lceil\frac{E}{e}\right\rceil \times
    \left\lceil\frac{N}{n}\right\rceil \times
    \left\lceil\frac{C}{qr}\right\rceil
}^\text{num of tiles} \times
\overbrace{
    \left\lceil\frac{m}{pt}\right\rceil
}^\text{reuse in GLB} \times
\overbrace{
    n \times qr \times (U(e-1) + R) \times W \times 1 \text{byte}
}^\text{tile size}
\]</div>
<h4 id="macs">MACs</h4>
<p>The number of MACs required by a Conv layer depends only on the shape of the layer.</p>
<div class="arithmatex">\[
\text{MACs} = N \times M \times E \times F \times C \times R \times S
\]</div>
<h4 id="latency">Latency</h4>
<div class="admonition info">
<p class="admonition-title">Important</p>
<p>The unit of latency here is <strong>cycles</strong>, and the number of DRAM/GLB accesses are <strong>bytes</strong>. Thus, the DRAM/GLB access time of the following equation should be <strong>cycles/byte</strong>.</p>
<p>However, in the provided sample code, the units of <code>DRAM_ACCESS_TIME</code> and <code>GLB_ACCESS_TIME</code> are <strong>cycles/transaction</strong>, so they should be divided by <code>bus_bw</code> and <code>noc_bw</code> (unit: <strong>bytes/transcation</strong>), respectively.</p>
</div>
<div class="arithmatex">\[
\begin{align}
\text{latency}
&amp;= \text{number of DRAM accesses} \times \text{DRAM access time} \\
&amp;+ \text{number of GLB accesses} \times \text{SRAM access time} \\
&amp;+ \text{PE array compute time} \\
&amp;+ \text{ofmap size} \times \text{PPU compute time per element}
\end{align}
\]</div>
<p>The compute time of the PE array will partially overlap with the GLB access, but the exact ratio is difficult to estimate, so we will temporarily ignore it. As for the compute latency of the post-processing unit (PPU), it can be assumed to be:</p>
<div class="arithmatex">\[
\text{PPU compute time per element} =
\cases{
    5 \text{ cycles, if MaxPool} \\
    1 \text{ cycle, otherwise}
}
\]</div>
<h4 id="power-and-energy-consumption">Power and Energy Consumption</h4>
<p>Given the following assumptions:</p>
<ul>
<li>Energy consumption per MAC: <span class="arithmatex">\(E_\text{MAC} = 2 \text{ μJ}\)</span></li>
<li>Energy consumption per GLB access: <span class="arithmatex">\(E_\text{GLB} = 10 \text{ μJ}\)</span></li>
<li>Energy consumption per DRAM access: <span class="arithmatex">\(E_\text{DRAM} = 200 \text{ μJ}\)</span></li>
<li>Power consumption of leackage: <span class="arithmatex">\(P_\text{leakage} = 50 \text{ μW}\)</span></li>
<li>clock rate: <span class="arithmatex">\(200 \text{ MHz}\)</span></li>
</ul>
<p>We can get:</p>
<div class="arithmatex">\[
E_\text{compute} = \text{MACs} \times E_\text{MAC} = \text{MACs} \times 2 \text{ μJ}
\]</div>
<div class="arithmatex">\[
\begin{align}
E_\text{memory} &amp;= (A_\text{DRAM} \times E_\text{DRAM}) + (A_\text{GLB} \times E_\text{GLB}) \\
&amp;= (A_\text{DRAM} \times 200 \text{ μJ}) + (A_\text{GLB} \times 10 \text{ μJ})
\end{align}
\]</div>
<div class="arithmatex">\[
T = \frac{T_\text{cycles}}{\text{clock rate}} = \frac{T_\text{cycles}}{200 \text{ MHz}}
\]</div>
<p>where <span class="arithmatex">\(A_\text{DRAM}\)</span> is number of DRAM accesses, <span class="arithmatex">\(A_\text{GLB}\)</span> is the number of GLB accesses, <span class="arithmatex">\(T\)</span> is the latency per layer in <strong>seconds</strong>, and <span class="arithmatex">\(T_\text{cycles}\)</span> is the latency per layer in <strong>cycles</strong>.</p>
<p>Therefore, the total energy and power consumption of a convolution layer are:</p>
<div class="arithmatex">\[
\begin{align}
E &amp;= E_\text{compute} + E_\text{memory} + (P_\text{leakage}  \times T) \\
&amp;= (\text{MACs} \times 2 \text{ μJ}) + (A_\text{DRAM} \times 200 \text{ μJ}) + (A_\text{GLB} \times 10 \text{ μJ}) + (50 \text{ μW} \times \frac{T_\text{cycles}}{200 \text{ MHz}}) \\
\end{align}
\]</div>
<div class="arithmatex">\[
\begin{align}
P &amp;= \frac{E_\text{compute} + E_\text{memory}}{T} + P_\text{leakage} \\
&amp;= \frac{200 \text{ MHz}}{T_\text{cycles}} \times [(\text{MACs} \times 2 \text{ μJ}) + (A_\text{DRAM} \times 200 \text{ μJ}) + (A_\text{GLB} \times 10 \text{ μJ})] + 50 \text{ μW}
\end{align}
\]</div>
<h3 id="summary">Summary</h3>
<p>The above calculation method is only a rough estimate, helping us to have a quantitative basis before deciding on the system specifications. Although some factors have not been considered (e.g., memory read and write speeds may differ), it may not fully match the final hardware performance, but the trends it presents are still valuable for reference.</p>
<p>In this assignment, we will ask students to calculate the following performance metrics and implement them in the analytical model:</p>
<ul>
<li>global buffer usage per pass<ul>
<li>filter</li>
<li>bias</li>
<li>psum</li>
</ul>
</li>
<li>global buffer accesses per layer<ul>
<li>filter reads</li>
<li>bias reads</li>
<li>psum reads</li>
<li>psum writes</li>
</ul>
</li>
<li>DRAM accesses per layer<ul>
<li>filter reads</li>
<li>bias reads</li>
<li>ofmap writes</li>
</ul>
</li>
</ul>
<h3 id="implementation-of-analytical-model">Implementation of Analytical Model</h3>
<p>In this lab, we use a Python class to implement the analytical model of the Eyeriss DLA. Please refer to the <code>EyerissAnalyzer</code> class defined in the <code>lab2/src/analytical_model/eyeriss.py</code> file provided by the teaching assistant. Below, we will explain the API design and usage of the analytical model.</p>
<h4 id="softwarehardware-configuration">Software/Hardware Configuration</h4>
<div class="language-python highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">EyerissAnalyzer</span><span class="p">:</span>
</span><span id="__span-22-2"><a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">hardware_param</span><span class="p">:</span> <span class="n">EyerissHardwareParam</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-22-3"><a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a>        <span class="k">pass</span>
</span><span id="__span-22-4"><a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a>
</span><span id="__span-22-5"><a id="__codelineno-22-5" name="__codelineno-22-5" href="#__codelineno-22-5"></a>    <span class="nd">@conv_shape</span><span class="o">.</span><span class="n">setter</span>
</span><span id="__span-22-6"><a id="__codelineno-22-6" name="__codelineno-22-6" href="#__codelineno-22-6"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">conv_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">conv_param</span><span class="p">:</span> <span class="n">Conv2DShapeParam</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-22-7"><a id="__codelineno-22-7" name="__codelineno-22-7" href="#__codelineno-22-7"></a>        <span class="k">pass</span>
</span><span id="__span-22-8"><a id="__codelineno-22-8" name="__codelineno-22-8" href="#__codelineno-22-8"></a>
</span><span id="__span-22-9"><a id="__codelineno-22-9" name="__codelineno-22-9" href="#__codelineno-22-9"></a>    <span class="nd">@maxpool_shape</span><span class="o">.</span><span class="n">setter</span>
</span><span id="__span-22-10"><a id="__codelineno-22-10" name="__codelineno-22-10" href="#__codelineno-22-10"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">maxpool_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">maxpool_param</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">MaxPool2DShapeParam</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-22-11"><a id="__codelineno-22-11" name="__codelineno-22-11" href="#__codelineno-22-11"></a>        <span class="k">pass</span>
</span><span id="__span-22-12"><a id="__codelineno-22-12" name="__codelineno-22-12" href="#__codelineno-22-12"></a>
</span><span id="__span-22-13"><a id="__codelineno-22-13" name="__codelineno-22-13" href="#__codelineno-22-13"></a>    <span class="nd">@mapping</span><span class="o">.</span><span class="n">setter</span>
</span><span id="__span-22-14"><a id="__codelineno-22-14" name="__codelineno-22-14" href="#__codelineno-22-14"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">mapping</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mapping_param</span><span class="p">:</span> <span class="n">EyerissMappingParam</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-22-15"><a id="__codelineno-22-15" name="__codelineno-22-15" href="#__codelineno-22-15"></a>        <span class="k">pass</span>
</span></code></pre></div>
<p>When initializing the <code>EyerissAnalyzer</code>, you need to specify the <code>EyerissHardwareParam</code> (see <a href="#hardware-parameters">Hardware Parameters</a>). Then, based on the results from network parsing, input the information for the Conv2d and MaxPool2d layers into the analytical model (see <a href="#defining-layer-information-class">Defining Layer Information</a>). Finally, set the desired mapping parameters for analysis (see <a href="#dataflow-mapping-parameters">Dataflow Mapping Parameters</a>). The numbers below are just examples, and you can try different settings.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="n">eyeriss</span> <span class="o">=</span> <span class="n">EyerissAnalyzer</span><span class="p">(</span>
</span><span id="__span-23-2"><a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a>    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Eyeriss&quot;</span><span class="p">,</span>
</span><span id="__span-23-3"><a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a>    <span class="n">hardware_param</span><span class="o">=</span><span class="n">EyerissHardwareParam</span><span class="p">(</span>
</span><span id="__span-23-4"><a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a>        <span class="n">pe_array_h</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
</span><span id="__span-23-5"><a id="__codelineno-23-5" name="__codelineno-23-5" href="#__codelineno-23-5"></a>        <span class="n">pe_array_w</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
</span><span id="__span-23-6"><a id="__codelineno-23-6" name="__codelineno-23-6" href="#__codelineno-23-6"></a>        <span class="n">ifmap_spad_size</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
</span><span id="__span-23-7"><a id="__codelineno-23-7" name="__codelineno-23-7" href="#__codelineno-23-7"></a>        <span class="n">filter_spad_size</span><span class="o">=</span><span class="mi">48</span><span class="p">,</span>
</span><span id="__span-23-8"><a id="__codelineno-23-8" name="__codelineno-23-8" href="#__codelineno-23-8"></a>        <span class="n">psum_spad_size</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span>
</span><span id="__span-23-9"><a id="__codelineno-23-9" name="__codelineno-23-9" href="#__codelineno-23-9"></a>        <span class="n">glb_size</span><span class="o">=</span><span class="mi">64</span> <span class="o">*</span> <span class="mi">2</span><span class="o">**</span><span class="mi">10</span><span class="p">,</span>
</span><span id="__span-23-10"><a id="__codelineno-23-10" name="__codelineno-23-10" href="#__codelineno-23-10"></a>        <span class="n">bus_bw</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
</span><span id="__span-23-11"><a id="__codelineno-23-11" name="__codelineno-23-11" href="#__codelineno-23-11"></a>        <span class="n">noc_bw</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
</span><span id="__span-23-12"><a id="__codelineno-23-12" name="__codelineno-23-12" href="#__codelineno-23-12"></a>    <span class="p">),</span>
</span><span id="__span-23-13"><a id="__codelineno-23-13" name="__codelineno-23-13" href="#__codelineno-23-13"></a><span class="p">)</span>
</span><span id="__span-23-14"><a id="__codelineno-23-14" name="__codelineno-23-14" href="#__codelineno-23-14"></a><span class="n">eyeriss</span><span class="o">.</span><span class="n">conv_shape</span> <span class="o">=</span> <span class="n">Conv2DShapeParam</span><span class="p">(</span><span class="n">N</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">H</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">R</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">S</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">E</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">F</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">C</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">M</span><span class="o">=</span><span class="mi">64</span><span class="p">,</span> <span class="n">U</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-23-15"><a id="__codelineno-23-15" name="__codelineno-23-15" href="#__codelineno-23-15"></a><span class="n">eyeriss</span><span class="o">.</span><span class="n">maxpool_shape</span> <span class="o">=</span> <span class="n">MaxPool2DShapeParam</span><span class="p">(</span><span class="n">N</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">stride</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span><span id="__span-23-16"><a id="__codelineno-23-16" name="__codelineno-23-16" href="#__codelineno-23-16"></a><span class="n">eyeriss</span><span class="o">.</span><span class="n">mapping</span> <span class="o">=</span> <span class="n">EyerissMappingParam</span><span class="p">(</span><span class="n">m</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">e</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span></code></pre></div>
<h4 id="performance-estimation">Performance Estimation</h4>
<p>In the previous <a href="#performance-metrics">Performance Metrics</a> section, we mentioned several performance indicators that we care about. The analytical model is responsible for calculating these performance metrics based on the settings above. The <code>EyerissAnalyzer</code> provides the following APIs to perform this task:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="nd">@property</span>
</span><span id="__span-24-2"><a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a><span class="k">def</span><span class="w"> </span><span class="nf">glb_usage_per_pass</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
</span><span id="__span-24-3"><a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a>    <span class="k">return</span> <span class="p">{</span>
</span><span id="__span-24-4"><a id="__codelineno-24-4" name="__codelineno-24-4" href="#__codelineno-24-4"></a>        <span class="s2">&quot;ifmap&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="__span-24-5"><a id="__codelineno-24-5" name="__codelineno-24-5" href="#__codelineno-24-5"></a>        <span class="s2">&quot;filter&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="__span-24-6"><a id="__codelineno-24-6" name="__codelineno-24-6" href="#__codelineno-24-6"></a>        <span class="s2">&quot;psum&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="__span-24-7"><a id="__codelineno-24-7" name="__codelineno-24-7" href="#__codelineno-24-7"></a>        <span class="s2">&quot;bias&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="__span-24-8"><a id="__codelineno-24-8" name="__codelineno-24-8" href="#__codelineno-24-8"></a>        <span class="s2">&quot;total&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="__span-24-9"><a id="__codelineno-24-9" name="__codelineno-24-9" href="#__codelineno-24-9"></a>    <span class="p">}</span>
</span><span id="__span-24-10"><a id="__codelineno-24-10" name="__codelineno-24-10" href="#__codelineno-24-10"></a>
</span><span id="__span-24-11"><a id="__codelineno-24-11" name="__codelineno-24-11" href="#__codelineno-24-11"></a><span class="nd">@property</span>
</span><span id="__span-24-12"><a id="__codelineno-24-12" name="__codelineno-24-12" href="#__codelineno-24-12"></a><span class="k">def</span><span class="w"> </span><span class="nf">dram_access_per_layer</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
</span><span id="__span-24-13"><a id="__codelineno-24-13" name="__codelineno-24-13" href="#__codelineno-24-13"></a>    <span class="k">return</span> <span class="p">{</span>
</span><span id="__span-24-14"><a id="__codelineno-24-14" name="__codelineno-24-14" href="#__codelineno-24-14"></a>        <span class="s2">&quot;ifmap_read&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="__span-24-15"><a id="__codelineno-24-15" name="__codelineno-24-15" href="#__codelineno-24-15"></a>        <span class="s2">&quot;filter_read&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="__span-24-16"><a id="__codelineno-24-16" name="__codelineno-24-16" href="#__codelineno-24-16"></a>        <span class="s2">&quot;bias_read&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="__span-24-17"><a id="__codelineno-24-17" name="__codelineno-24-17" href="#__codelineno-24-17"></a>        <span class="s2">&quot;ofmap_write&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="__span-24-18"><a id="__codelineno-24-18" name="__codelineno-24-18" href="#__codelineno-24-18"></a>        <span class="s2">&quot;read&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="__span-24-19"><a id="__codelineno-24-19" name="__codelineno-24-19" href="#__codelineno-24-19"></a>        <span class="s2">&quot;write&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="__span-24-20"><a id="__codelineno-24-20" name="__codelineno-24-20" href="#__codelineno-24-20"></a>        <span class="s2">&quot;total&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="__span-24-21"><a id="__codelineno-24-21" name="__codelineno-24-21" href="#__codelineno-24-21"></a>    <span class="p">}</span>
</span><span id="__span-24-22"><a id="__codelineno-24-22" name="__codelineno-24-22" href="#__codelineno-24-22"></a>
</span><span id="__span-24-23"><a id="__codelineno-24-23" name="__codelineno-24-23" href="#__codelineno-24-23"></a><span class="nd">@property</span>
</span><span id="__span-24-24"><a id="__codelineno-24-24" name="__codelineno-24-24" href="#__codelineno-24-24"></a><span class="k">def</span><span class="w"> </span><span class="nf">glb_access_per_layer</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
</span><span id="__span-24-25"><a id="__codelineno-24-25" name="__codelineno-24-25" href="#__codelineno-24-25"></a>    <span class="k">return</span> <span class="p">{</span>
</span><span id="__span-24-26"><a id="__codelineno-24-26" name="__codelineno-24-26" href="#__codelineno-24-26"></a>        <span class="s2">&quot;ifmap_read&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="__span-24-27"><a id="__codelineno-24-27" name="__codelineno-24-27" href="#__codelineno-24-27"></a>        <span class="s2">&quot;filter_read&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="__span-24-28"><a id="__codelineno-24-28" name="__codelineno-24-28" href="#__codelineno-24-28"></a>        <span class="s2">&quot;bias_read&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="__span-24-29"><a id="__codelineno-24-29" name="__codelineno-24-29" href="#__codelineno-24-29"></a>        <span class="s2">&quot;psum_read&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="__span-24-30"><a id="__codelineno-24-30" name="__codelineno-24-30" href="#__codelineno-24-30"></a>        <span class="s2">&quot;psum_write&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="__span-24-31"><a id="__codelineno-24-31" name="__codelineno-24-31" href="#__codelineno-24-31"></a>        <span class="s2">&quot;read&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="__span-24-32"><a id="__codelineno-24-32" name="__codelineno-24-32" href="#__codelineno-24-32"></a>        <span class="s2">&quot;write&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="__span-24-33"><a id="__codelineno-24-33" name="__codelineno-24-33" href="#__codelineno-24-33"></a>        <span class="s2">&quot;total&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="__span-24-34"><a id="__codelineno-24-34" name="__codelineno-24-34" href="#__codelineno-24-34"></a>    <span class="p">}</span>
</span><span id="__span-24-35"><a id="__codelineno-24-35" name="__codelineno-24-35" href="#__codelineno-24-35"></a>
</span><span id="__span-24-36"><a id="__codelineno-24-36" name="__codelineno-24-36" href="#__codelineno-24-36"></a><span class="nd">@property</span>
</span><span id="__span-24-37"><a id="__codelineno-24-37" name="__codelineno-24-37" href="#__codelineno-24-37"></a><span class="k">def</span><span class="w"> </span><span class="nf">latency_per_layer</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="__span-24-38"><a id="__codelineno-24-38" name="__codelineno-24-38" href="#__codelineno-24-38"></a>    <span class="k">return</span> <span class="mi">0</span>
</span><span id="__span-24-39"><a id="__codelineno-24-39" name="__codelineno-24-39" href="#__codelineno-24-39"></a>
</span><span id="__span-24-40"><a id="__codelineno-24-40" name="__codelineno-24-40" href="#__codelineno-24-40"></a><span class="nd">@property</span>
</span><span id="__span-24-41"><a id="__codelineno-24-41" name="__codelineno-24-41" href="#__codelineno-24-41"></a><span class="k">def</span><span class="w"> </span><span class="nf">macs_per_layer</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="__span-24-42"><a id="__codelineno-24-42" name="__codelineno-24-42" href="#__codelineno-24-42"></a>    <span class="k">return</span> <span class="mi">0</span>
</span><span id="__span-24-43"><a id="__codelineno-24-43" name="__codelineno-24-43" href="#__codelineno-24-43"></a>
</span><span id="__span-24-44"><a id="__codelineno-24-44" name="__codelineno-24-44" href="#__codelineno-24-44"></a><span class="nd">@property</span>
</span><span id="__span-24-45"><a id="__codelineno-24-45" name="__codelineno-24-45" href="#__codelineno-24-45"></a><span class="k">def</span><span class="w"> </span><span class="nf">power_per_layer</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="__span-24-46"><a id="__codelineno-24-46" name="__codelineno-24-46" href="#__codelineno-24-46"></a>    <span class="k">return</span> <span class="mi">0</span>
</span></code></pre></div>
<p>After initializing the analytical model, you can obtain the system's performance metrics under the given settings. Here is an example:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;maximum GLB usage: </span><span class="si">{</span><span class="n">eyeriss</span><span class="o">.</span><span class="n">glb_usage_per_pass</span><span class="p">[</span><span class="s2">&quot;total&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1"> bytes&#39;</span><span class="p">)</span>
</span><span id="__span-25-2"><a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;number of DRAM reads: </span><span class="si">{</span><span class="n">eyeriss</span><span class="o">.</span><span class="n">dram_access_per_layer</span><span class="p">[</span><span class="s2">&quot;read&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1"> bytes&#39;</span><span class="p">)</span>
</span><span id="__span-25-3"><a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;number of DRAM write: </span><span class="si">{</span><span class="n">eyeriss</span><span class="o">.</span><span class="n">dram_access_per_layer</span><span class="p">[</span><span class="s2">&quot;write&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1"> bytes&#39;</span><span class="p">)</span>
</span><span id="__span-25-4"><a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;number of GLB reads: </span><span class="si">{</span><span class="n">eyeriss</span><span class="o">.</span><span class="n">glb_access_per_layer</span><span class="p">[</span><span class="s2">&quot;read&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1"> bytes&#39;</span><span class="p">)</span>
</span><span id="__span-25-5"><a id="__codelineno-25-5" name="__codelineno-25-5" href="#__codelineno-25-5"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;number of GLB write: </span><span class="si">{</span><span class="n">eyeriss</span><span class="o">.</span><span class="n">glb_access_per_layer</span><span class="p">[</span><span class="s2">&quot;write&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1"> bytes&#39;</span><span class="p">)</span>
</span><span id="__span-25-6"><a id="__codelineno-25-6" name="__codelineno-25-6" href="#__codelineno-25-6"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;inference latency: </span><span class="si">{</span><span class="n">eyeriss</span><span class="o">.</span><span class="n">latency_per_layer</span><span class="si">}</span><span class="s1"> cycles&#39;</span><span class="p">)</span>
</span></code></pre></div>
<p>The assignment will require students to implement getter functions for performance metrics based on the above API. Please refer to the code and the assignment instructions for further details.</p>
<h3 id="integration-with-network-parser">Integration with Network Parser</h3>
<p>Up to this point, the analytical model can evaluate performance based on the layer information and mapping parameters specified by the user, but it still requires manual input, which can be inconvenient. At this point, we can integrate the network parser we just implemented, directly load the pre-trained model, obtain the required information, and save it in a unified format.</p>
<p>The following code is the structure for integrating the network parser with the analytical model. In the <code>for</code> loop, the parsed layer information is fed into the analytical model for computation, and finally, the results are saved as a <code>.csv</code> file.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-26-2"><a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a>    <span class="c1"># Network parsing</span>
</span><span id="__span-26-3"><a id="__codelineno-26-3" name="__codelineno-26-3" href="#__codelineno-26-3"></a>    <span class="n">model</span> <span class="o">=</span> <span class="n">load_model</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
</span><span id="__span-26-4"><a id="__codelineno-26-4" name="__codelineno-26-4" href="#__codelineno-26-4"></a>    <span class="n">layers</span> <span class="o">=</span> <span class="n">parse_onnx</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
</span><span id="__span-26-5"><a id="__codelineno-26-5" name="__codelineno-26-5" href="#__codelineno-26-5"></a>
</span><span id="__span-26-6"><a id="__codelineno-26-6" name="__codelineno-26-6" href="#__codelineno-26-6"></a>    <span class="c1"># Hardware configuration</span>
</span><span id="__span-26-7"><a id="__codelineno-26-7" name="__codelineno-26-7" href="#__codelineno-26-7"></a>    <span class="n">eyeriss</span> <span class="o">=</span> <span class="n">EyerissAnalyzer</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
</span><span id="__span-26-8"><a id="__codelineno-26-8" name="__codelineno-26-8" href="#__codelineno-26-8"></a>    <span class="n">eyeriss</span><span class="o">.</span><span class="n">mapping</span> <span class="o">=</span> <span class="o">...</span>
</span><span id="__span-26-9"><a id="__codelineno-26-9" name="__codelineno-26-9" href="#__codelineno-26-9"></a>
</span><span id="__span-26-10"><a id="__codelineno-26-10" name="__codelineno-26-10" href="#__codelineno-26-10"></a>    <span class="c1"># Workload mapping and performance estimation</span>
</span><span id="__span-26-11"><a id="__codelineno-26-11" name="__codelineno-26-11" href="#__codelineno-26-11"></a>    <span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">layers</span><span class="p">)):</span>
</span><span id="__span-26-12"><a id="__codelineno-26-12" name="__codelineno-26-12" href="#__codelineno-26-12"></a>        <span class="n">eyeriss</span><span class="o">.</span><span class="n">conv_shape</span> <span class="o">=</span> <span class="o">...</span>
</span><span id="__span-26-13"><a id="__codelineno-26-13" name="__codelineno-26-13" href="#__codelineno-26-13"></a>        <span class="n">eyeriss</span><span class="o">.</span><span class="n">maxpool_shape</span> <span class="o">=</span> <span class="o">...</span>
</span><span id="__span-26-14"><a id="__codelineno-26-14" name="__codelineno-26-14" href="#__codelineno-26-14"></a>        <span class="n">perf_report</span><span class="p">(</span><span class="n">eyeriss</span><span class="p">,</span> <span class="n">output</span><span class="o">.</span><span class="n">csv</span><span class="p">)</span>
</span><span id="__span-26-15"><a id="__codelineno-26-15" name="__codelineno-26-15" href="#__codelineno-26-15"></a>
</span><span id="__span-26-16"><a id="__codelineno-26-16" name="__codelineno-26-16" href="#__codelineno-26-16"></a>
</span><span id="__span-26-17"><a id="__codelineno-26-17" name="__codelineno-26-17" href="#__codelineno-26-17"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
</span><span id="__span-26-18"><a id="__codelineno-26-18" name="__codelineno-26-18" href="#__codelineno-26-18"></a>    <span class="n">main</span><span class="p">()</span>
</span></code></pre></div>
<h2 id="lab-23-design-space-exploration-dse">Lab 2.3 - Design Space Exploration (DSE)</h2>
<p>After deciding on the target operators to accelerate and the hardware architecture, we need to perform <a href="https://en.wikipedia.org/wiki/Design_space_exploration">design space exploration (DSE)</a> to find the optimal parameter configuration. We will automate the process to list all possible configurations and select the best solution based on the optimization goals set by the user. In this lab, we will implement the <code>EyerissMapper</code> class and use exhaustive search to perform DSE.</p>
<h3 id="roofline-model">Roofline Model</h3>
<p>Fist of all, we will introduce the <a href="https://en.wikipedia.org/wiki/Roofline_model">roofline model</a>, which is an intuitive visual performance model used to provide performance estimates of <strong>a given workload running on a specific architecture</strong>, by showing inherent hardware limitations, and potential benefit and priority of optimizations.</p>
<p>In the subsequent sections, we are going to learn how to formulate:</p>
<ol>
<li>the charateristics of a given workload/application</li>
<li>the performance provided by hardware under some limitations</li>
</ol>
<h4 id="workload-characteristics">Workload Characteristics</h4>
<p>For a given workload, let <span class="arithmatex">\(W\)</span> represent the total computational requirement and <span class="arithmatex">\(Q\)</span> the data transfer requirement. The <strong>operational intensity</strong> (also called arithmetic intensity) <span class="arithmatex">\(I\)</span> characterizes the workload as follows:</p>
<div class="arithmatex">\[
I = \frac{W}{Q}
\]</div>
<p>A workload with higher operational intensity relies more on computation, making it <strong>compute-bound</strong>. In such cases, optimizations should focus on accelerating computation, such as increasing the number of processing elements (PEs) to exploit parallelism. Conversely, a workload with lower operational intensity is <strong>memory-bound</strong>, and optimizations should aim to reduce memory traffic or increase the memory bandwidth.</p>
<p>For example, consider <strong>matrix-matrix multiplication</strong> <span class="arithmatex">\(C = AB\)</span>, where <span class="arithmatex">\(A \in \mathbb{R}^{m \times n}\)</span>, <span class="arithmatex">\(B \in \mathbb{R}^{n \times k}\)</span>, and <span class="arithmatex">\(C \in \mathbb{R}^{m \times k}\)</span>. The operational intensity is given by:</p>
<div class="arithmatex">\[
I_\text{mm} = \frac{\text{num of MACs}}{\text{num of data} \times \text{num of bytes per data}} = \frac{mnk}{mn + nk + mk} = O(N)
\]</div>
<p>Similarly, for <strong>matrix-vector multiplication</strong> <span class="arithmatex">\(y = A x\)</span>, where <span class="arithmatex">\(A \in \mathbb{R}^{m \times n}\)</span>, <span class="arithmatex">\(x \in \mathbb{R}^{n \times 1}\)</span>, and <span class="arithmatex">\(y \in \mathbb{R}^{m \times 1}\)</span>, the operational intensity is:</p>
<div class="arithmatex">\[
I_\text{mv} = \frac{mn}{mn + m + n} = O(1)
\]</div>
<p>With the <a href="https://en.wikipedia.org/wiki/Asymptotic_analysis">asymptotic analysis</a>, we observe that matrix-matrix multiplication is more compute-bound, whereas matrix-vector multiplication is more memory-bound as the problem size increases.</p>
<h4 id="hardware-limitations">Hardware Limitations</h4>
<p>For a given hardware architecture, the capacity of such a system is upper-bounded by two parameters, the <strong>peak performance of the processor</strong> and the <strong>peak bandwidth of the memory</strong>. The roofline is formulated as the following:</p>
<div class="arithmatex">\[
P = \min(\pi, ~ \beta \times I)
\]</div>
<p>where <span class="arithmatex">\(P\)</span> is the attainable performance, <span class="arithmatex">\(\pi\)</span> is the peak performance, <span class="arithmatex">\(\beta\)</span> is the peak bandwidth, and <span class="arithmatex">\(I\)</span> is the operational intensity.</p>
<p>For the Eyeriss DLA in our lab, each PE complete a MAC in a cycle, so the peak performance <span class="arithmatex">\(\pi\)</span> is bounded by the number of PEs <span class="arithmatex">\(N_\text{PE}\)</span>, that is:</p>
<div class="arithmatex">\[
\pi \le k \times N_\text{PE}
\]</div>
<p>where <span class="arithmatex">\(k\)</span> is a constant used to make the unit consistent between the both sides of the inequality (e.g. <span class="arithmatex">\(\text{MACs}/\text{cycle}\)</span> or <span class="arithmatex">\(\text{FLOPs}/\text{second}\)</span>), which can be the number of MACs a PE can compute in a cycle or the number of arithmetic operations a PE can compute in a second.</p>
<p>With the above formulation, we can plot the performance bound as follows:</p>
<ul>
<li>y axis: performance <span class="arithmatex">\(P\)</span> (unit: FLOPS or MACs/cycle)</li>
<li>x axis: operational intensity <span class="arithmatex">\(I\)</span> (unit: FLOPs/byte or MACs/byte)</li>
<li>black solid line: performance upper bound of a given hardware</li>
<li>red dashed line: machine balance point, separating the memory-bound (left) and compute-bound (right) regions</li>
</ul>
<p><img alt="roofline-baseline" src="../../assets/images/BkMeq19o1g.png" /></p>
<p>For a given hardware architecture, different mapping parameter choices leads to different number of memory accesses, and hence affect the operational intensity (OI). The following figure shows that Mapping 1 (OI = 8 &lt; 12) is memory-bound, and Mapping 2 (OI = 18 &gt; 12) is compute-bound.</p>
<!-- ![roofline-mapping](/assets/images//rJnJ9y9oJe.png) -->

<p><img alt="roofline-mapping" src="../../assets/images/SJi-Cxqikg.png" /></p>
<p>Changes in hardware parameters alter the capacity, leading to different rooflines. For the same workload (fixed OI = 16), it is compute-bound on Hardware 1 with 48 PEs, while it is memory-bound on Hardware 2 with 72 PEs.</p>
<!-- ![roofline-hardware](https://hackmd.io/_uploads/SyQgmgciye.png) -->

<p><img alt="roofline-hardware" src="../../assets/images/rkU0Agcoyl.png" /></p>
<p>We provide a Python script <code>roofline.py</code> in the project root to plot the roofline model. It supports the following functionalities:</p>
<ul>
<li>Generate multiple rooflines based on given peak performance and peak memory bandwidth</li>
<li>Plot multiple workload points by specifying their operations intensities</li>
</ul>
<p>For example, you can define and plot a Roofline model by calling <code>plot_roofline</code> function:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="n">peak_performance</span> <span class="o">=</span> <span class="mf">60.0</span>
</span><span id="__span-27-2"><a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a><span class="n">peak_bandwidth</span> <span class="o">=</span> <span class="mf">6.0</span>
</span><span id="__span-27-3"><a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a>
</span><span id="__span-27-4"><a id="__codelineno-27-4" name="__codelineno-27-4" href="#__codelineno-27-4"></a><span class="n">plot_roofline</span><span class="p">(</span>
</span><span id="__span-27-5"><a id="__codelineno-27-5" name="__codelineno-27-5" href="#__codelineno-27-5"></a>    <span class="n">rooflines</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;Custom Hardware&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">peak_performance</span><span class="p">,</span> <span class="n">peak_bandwidth</span><span class="p">)},</span>
</span><span id="__span-27-6"><a id="__codelineno-27-6" name="__codelineno-27-6" href="#__codelineno-27-6"></a>    <span class="n">workloads</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;New Mapping&quot;</span><span class="p">:</span> <span class="mf">10.0</span><span class="p">},</span>
</span><span id="__span-27-7"><a id="__codelineno-27-7" name="__codelineno-27-7" href="#__codelineno-27-7"></a>    <span class="n">filename</span><span class="o">=</span><span class="s2">&quot;log/figure/custom.png&quot;</span><span class="p">,</span>
</span><span id="__span-27-8"><a id="__codelineno-27-8" name="__codelineno-27-8" href="#__codelineno-27-8"></a><span class="p">)</span>
</span></code></pre></div>
<blockquote>
<p>[!Note]
The above code was updated at 3/29 17:30</p>
</blockquote>
<p>Then, you can execute this script with:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a>python3<span class="w"> </span>roofline.py
</span></code></pre></div>
<h3 id="mapping-parameter-search">Mapping Parameter Search</h3>
<h4 id="search-space-construction">Search Space Construction</h4>
<p>First, we need to list all possible parameter configurations, as shown in the following code:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">itertools</span><span class="w"> </span><span class="kn">import</span> <span class="n">product</span>
</span><span id="__span-29-2"><a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a>
</span><span id="__span-29-3"><a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a><span class="k">def</span><span class="w"> </span><span class="nf">generate_mappings</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">EyerissMappingParam</span><span class="p">]:</span>
</span><span id="__span-29-4"><a id="__codelineno-29-4" name="__codelineno-29-4" href="#__codelineno-29-4"></a>    <span class="n">n_avaliable_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="__span-29-5"><a id="__codelineno-29-5" name="__codelineno-29-5" href="#__codelineno-29-5"></a>    <span class="n">p_available_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p_avaliable</span><span class="p">()</span>
</span><span id="__span-29-6"><a id="__codelineno-29-6" name="__codelineno-29-6" href="#__codelineno-29-6"></a>    <span class="n">q_available_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">q_avaliable</span><span class="p">()</span>
</span><span id="__span-29-7"><a id="__codelineno-29-7" name="__codelineno-29-7" href="#__codelineno-29-7"></a>    <span class="n">e_available_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">e_available</span><span class="p">()</span>
</span><span id="__span-29-8"><a id="__codelineno-29-8" name="__codelineno-29-8" href="#__codelineno-29-8"></a>    <span class="n">r_available_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">r_available</span><span class="p">()</span>
</span><span id="__span-29-9"><a id="__codelineno-29-9" name="__codelineno-29-9" href="#__codelineno-29-9"></a>    <span class="n">t_available_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_available</span><span class="p">()</span>
</span><span id="__span-29-10"><a id="__codelineno-29-10" name="__codelineno-29-10" href="#__codelineno-29-10"></a>    <span class="n">m_available_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_available</span><span class="p">()</span>
</span><span id="__span-29-11"><a id="__codelineno-29-11" name="__codelineno-29-11" href="#__codelineno-29-11"></a>
</span><span id="__span-29-12"><a id="__codelineno-29-12" name="__codelineno-29-12" href="#__codelineno-29-12"></a>    <span class="n">candidate_solutions</span> <span class="o">=</span> <span class="n">product</span><span class="p">(</span>
</span><span id="__span-29-13"><a id="__codelineno-29-13" name="__codelineno-29-13" href="#__codelineno-29-13"></a>        <span class="n">m_available_list</span><span class="p">,</span>
</span><span id="__span-29-14"><a id="__codelineno-29-14" name="__codelineno-29-14" href="#__codelineno-29-14"></a>        <span class="n">n_avaliable_list</span><span class="p">,</span>
</span><span id="__span-29-15"><a id="__codelineno-29-15" name="__codelineno-29-15" href="#__codelineno-29-15"></a>        <span class="n">e_available_list</span><span class="p">,</span>
</span><span id="__span-29-16"><a id="__codelineno-29-16" name="__codelineno-29-16" href="#__codelineno-29-16"></a>        <span class="n">p_available_list</span><span class="p">,</span>
</span><span id="__span-29-17"><a id="__codelineno-29-17" name="__codelineno-29-17" href="#__codelineno-29-17"></a>        <span class="n">q_available_list</span><span class="p">,</span>
</span><span id="__span-29-18"><a id="__codelineno-29-18" name="__codelineno-29-18" href="#__codelineno-29-18"></a>        <span class="n">r_available_list</span><span class="p">,</span>
</span><span id="__span-29-19"><a id="__codelineno-29-19" name="__codelineno-29-19" href="#__codelineno-29-19"></a>        <span class="n">t_available_list</span><span class="p">,</span>
</span><span id="__span-29-20"><a id="__codelineno-29-20" name="__codelineno-29-20" href="#__codelineno-29-20"></a>    <span class="p">)</span>
</span><span id="__span-29-21"><a id="__codelineno-29-21" name="__codelineno-29-21" href="#__codelineno-29-21"></a>    <span class="k">return</span> <span class="n">candidate_solutions</span>
</span></code></pre></div>
<p>Each of <code>*_available()</code> functions will return a list of integers, representing the set of possible values for each mapping parameter. For a detailed explanation of the approach, please refer to the example code provided by the teaching assistant in <code>analytical_model/mapper.py</code>. Then, use <code>itertools.product(...)</code> to compute the <a href="https://en.wikipedia.org/wiki/Cartesian_product">Cartesian product</a>, which will give you a list of tuples, where each tuple represents a set of mapping parameters.</p>
<h4 id="search-space-pruning-by-constraints">Search Space Pruning by Constraints</h4>
<p>To reduce the complexity of subsequent hardware implementation, we will set certain parameter combinations that the hardware cannot support and remove them from the search space.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mapping</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="__span-30-2"><a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a>    <span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">mapping</span>
</span><span id="__span-30-3"><a id="__codelineno-30-3" name="__codelineno-30-3" href="#__codelineno-30-3"></a>
</span><span id="__span-30-4"><a id="__codelineno-30-4" name="__codelineno-30-4" href="#__codelineno-30-4"></a>    <span class="c1"># pq constraints</span>
</span><span id="__span-30-5"><a id="__codelineno-30-5" name="__codelineno-30-5" href="#__codelineno-30-5"></a>    <span class="k">if</span> <span class="n">p</span> <span class="o">*</span> <span class="n">q</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">hardware</span><span class="o">.</span><span class="n">filter_spad_size</span> <span class="o">//</span> <span class="bp">self</span><span class="o">.</span><span class="n">conv_analyzer</span><span class="o">.</span><span class="n">conv_shape</span><span class="o">.</span><span class="n">S</span><span class="p">:</span>
</span><span id="__span-30-6"><a id="__codelineno-30-6" name="__codelineno-30-6" href="#__codelineno-30-6"></a>        <span class="k">return</span> <span class="kc">False</span>
</span><span id="__span-30-7"><a id="__codelineno-30-7" name="__codelineno-30-7" href="#__codelineno-30-7"></a>
</span><span id="__span-30-8"><a id="__codelineno-30-8" name="__codelineno-30-8" href="#__codelineno-30-8"></a>    <span class="c1"># e constraints</span>
</span><span id="__span-30-9"><a id="__codelineno-30-9" name="__codelineno-30-9" href="#__codelineno-30-9"></a>    <span class="k">if</span> <span class="p">(</span>
</span><span id="__span-30-10"><a id="__codelineno-30-10" name="__codelineno-30-10" href="#__codelineno-30-10"></a>        <span class="n">e</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">hardware</span><span class="o">.</span><span class="n">pe_array_w</span> <span class="o">!=</span> <span class="mi">0</span>
</span><span id="__span-30-11"><a id="__codelineno-30-11" name="__codelineno-30-11" href="#__codelineno-30-11"></a>        <span class="ow">and</span> <span class="n">e</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hardware</span><span class="o">.</span><span class="n">pe_array_w</span> <span class="o">//</span> <span class="mi">2</span>
</span><span id="__span-30-12"><a id="__codelineno-30-12" name="__codelineno-30-12" href="#__codelineno-30-12"></a>        <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">conv_analyzer</span><span class="o">.</span><span class="n">conv_shape</span><span class="o">.</span><span class="n">E</span> <span class="o">!=</span> <span class="n">e</span>
</span><span id="__span-30-13"><a id="__codelineno-30-13" name="__codelineno-30-13" href="#__codelineno-30-13"></a>    <span class="p">):</span>
</span><span id="__span-30-14"><a id="__codelineno-30-14" name="__codelineno-30-14" href="#__codelineno-30-14"></a>        <span class="k">return</span> <span class="kc">False</span>
</span><span id="__span-30-15"><a id="__codelineno-30-15" name="__codelineno-30-15" href="#__codelineno-30-15"></a>
</span><span id="__span-30-16"><a id="__codelineno-30-16" name="__codelineno-30-16" href="#__codelineno-30-16"></a>    <span class="c1"># rt constraints</span>
</span><span id="__span-30-17"><a id="__codelineno-30-17" name="__codelineno-30-17" href="#__codelineno-30-17"></a>    <span class="k">if</span> <span class="p">(</span>
</span><span id="__span-30-18"><a id="__codelineno-30-18" name="__codelineno-30-18" href="#__codelineno-30-18"></a>        <span class="n">r</span> <span class="o">*</span> <span class="n">t</span>
</span><span id="__span-30-19"><a id="__codelineno-30-19" name="__codelineno-30-19" href="#__codelineno-30-19"></a>        <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hardware</span><span class="o">.</span><span class="n">pe_array_h</span>
</span><span id="__span-30-20"><a id="__codelineno-30-20" name="__codelineno-30-20" href="#__codelineno-30-20"></a>        <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">hardware</span><span class="o">.</span><span class="n">pe_array_w</span>
</span><span id="__span-30-21"><a id="__codelineno-30-21" name="__codelineno-30-21" href="#__codelineno-30-21"></a>        <span class="o">//</span> <span class="bp">self</span><span class="o">.</span><span class="n">conv_analyzer</span><span class="o">.</span><span class="n">conv_shape</span><span class="o">.</span><span class="n">R</span>
</span><span id="__span-30-22"><a id="__codelineno-30-22" name="__codelineno-30-22" href="#__codelineno-30-22"></a>        <span class="o">//</span> <span class="n">e</span>
</span><span id="__span-30-23"><a id="__codelineno-30-23" name="__codelineno-30-23" href="#__codelineno-30-23"></a>    <span class="p">):</span>
</span><span id="__span-30-24"><a id="__codelineno-30-24" name="__codelineno-30-24" href="#__codelineno-30-24"></a>        <span class="k">return</span> <span class="kc">False</span>
</span><span id="__span-30-25"><a id="__codelineno-30-25" name="__codelineno-30-25" href="#__codelineno-30-25"></a>
</span><span id="__span-30-26"><a id="__codelineno-30-26" name="__codelineno-30-26" href="#__codelineno-30-26"></a>    <span class="c1"># m constraints</span>
</span><span id="__span-30-27"><a id="__codelineno-30-27" name="__codelineno-30-27" href="#__codelineno-30-27"></a>    <span class="k">if</span> <span class="n">m</span> <span class="o">%</span> <span class="n">p</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="__span-30-28"><a id="__codelineno-30-28" name="__codelineno-30-28" href="#__codelineno-30-28"></a>        <span class="k">return</span> <span class="kc">False</span>
</span><span id="__span-30-29"><a id="__codelineno-30-29" name="__codelineno-30-29" href="#__codelineno-30-29"></a>
</span><span id="__span-30-30"><a id="__codelineno-30-30" name="__codelineno-30-30" href="#__codelineno-30-30"></a>    <span class="k">return</span> <span class="kc">True</span>
</span><span id="__span-30-31"><a id="__codelineno-30-31" name="__codelineno-30-31" href="#__codelineno-30-31"></a>
</span><span id="__span-30-32"><a id="__codelineno-30-32" name="__codelineno-30-32" href="#__codelineno-30-32"></a><span class="n">candidate_solutions</span> <span class="o">=</span> <span class="p">[</span><span class="n">sol</span> <span class="k">for</span> <span class="n">sol</span> <span class="ow">in</span> <span class="n">candidate_solutions</span> <span class="k">if</span> <span class="n">validate</span><span class="p">(</span><span class="n">sol</span><span class="p">)]</span>
</span></code></pre></div>
<h4 id="design-point-evaluation">Design Point Evaluation</h4>
<p>The remaining parameter configurations are those that are still valid under our hardware constraints. Next, we can design our own scoring method, where a set of <code>EyerissMappingParam</code> is used as input, and it outputs a score that can be used for ranking. After scoring each <code>EyerissMappingParam</code> in the remaining <code>candidate_solutions</code>, we can sort them to find the best mapping parameters for the specified operator size and hardware configuration.</p>
<p>The entire exploration process will be implemented in the <code>EyerissMapper.run()</code> method, which constructs the search space with <code>generate_mappings()</code>, calculate the performance metrics with <code>Eyeriss.Analyzer.summary()</code>, and finally return the best N solutions with the scoring function <code>EyerissMapper.evaluate()</code> defined by youself. Here is the function code:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-31-1"><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">heapq</span><span class="w"> </span><span class="kn">import</span> <span class="n">nlargest</span><span class="p">,</span> <span class="n">nsmallest</span>
</span><span id="__span-31-2"><a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a>
</span><span id="__span-31-3"><a id="__codelineno-31-3" name="__codelineno-31-3" href="#__codelineno-31-3"></a><span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span>
</span><span id="__span-31-4"><a id="__codelineno-31-4" name="__codelineno-31-4" href="#__codelineno-31-4"></a>    <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-31-5"><a id="__codelineno-31-5" name="__codelineno-31-5" href="#__codelineno-31-5"></a>    <span class="n">conv2d</span><span class="p">:</span> <span class="n">Conv2DShapeParam</span><span class="p">,</span>
</span><span id="__span-31-6"><a id="__codelineno-31-6" name="__codelineno-31-6" href="#__codelineno-31-6"></a>    <span class="n">maxpool</span><span class="p">:</span> <span class="n">MaxPool2DShapeParam</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-31-7"><a id="__codelineno-31-7" name="__codelineno-31-7" href="#__codelineno-31-7"></a>    <span class="n">num_solutions</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="__span-31-8"><a id="__codelineno-31-8" name="__codelineno-31-8" href="#__codelineno-31-8"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">AnalysisResult</span><span class="p">]:</span>
</span><span id="__span-31-9"><a id="__codelineno-31-9" name="__codelineno-31-9" href="#__codelineno-31-9"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">analyzer</span><span class="o">.</span><span class="n">conv_shape</span> <span class="o">=</span> <span class="n">conv2d</span>
</span><span id="__span-31-10"><a id="__codelineno-31-10" name="__codelineno-31-10" href="#__codelineno-31-10"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">analyzer</span><span class="o">.</span><span class="n">maxpool_shape</span> <span class="o">=</span> <span class="n">maxpool</span>
</span><span id="__span-31-11"><a id="__codelineno-31-11" name="__codelineno-31-11" href="#__codelineno-31-11"></a>
</span><span id="__span-31-12"><a id="__codelineno-31-12" name="__codelineno-31-12" href="#__codelineno-31-12"></a>    <span class="n">results</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">AnalysisResult</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-31-13"><a id="__codelineno-31-13" name="__codelineno-31-13" href="#__codelineno-31-13"></a>
</span><span id="__span-31-14"><a id="__codelineno-31-14" name="__codelineno-31-14" href="#__codelineno-31-14"></a>    <span class="k">for</span> <span class="n">mapping</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_mappings</span><span class="p">():</span>  <span class="c1"># construct the search space for mapping parameters</span>
</span><span id="__span-31-15"><a id="__codelineno-31-15" name="__codelineno-31-15" href="#__codelineno-31-15"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">analyzer</span><span class="o">.</span><span class="n">mapping</span> <span class="o">=</span> <span class="n">mapping</span>
</span><span id="__span-31-16"><a id="__codelineno-31-16" name="__codelineno-31-16" href="#__codelineno-31-16"></a>        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analyzer</span><span class="o">.</span><span class="n">summary</span>  <span class="c1"># project the configuration to performance metrics</span>
</span><span id="__span-31-17"><a id="__codelineno-31-17" name="__codelineno-31-17" href="#__codelineno-31-17"></a>        <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
</span><span id="__span-31-18"><a id="__codelineno-31-18" name="__codelineno-31-18" href="#__codelineno-31-18"></a>
</span><span id="__span-31-19"><a id="__codelineno-31-19" name="__codelineno-31-19" href="#__codelineno-31-19"></a>    <span class="n">results</span> <span class="o">=</span> <span class="n">nlargest</span><span class="p">(</span><span class="n">num_solutions</span><span class="p">,</span> <span class="n">results</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">evaluate</span><span class="p">)</span>  <span class="c1"># evaluate each design point</span>
</span><span id="__span-31-20"><a id="__codelineno-31-20" name="__codelineno-31-20" href="#__codelineno-31-20"></a>    <span class="k">return</span> <span class="n">results</span>
</span></code></pre></div>
<p>In the assignment, students will need to design and implement your own scoring algorithm in <code>Eyeriss.evaluate()</code> to evaluate how good/bad a design point (a set of mapping parameters) is and explain why you chose this design in your report.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-32-1"><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">evaluate</span><span class="p">(</span><span class="n">metrics</span><span class="p">:</span> <span class="n">AnalysisResult</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="__span-32-2"><a id="__codelineno-32-2" name="__codelineno-32-2" href="#__codelineno-32-2"></a>    <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</span><span id="__span-32-3"><a id="__codelineno-32-3" name="__codelineno-32-3" href="#__codelineno-32-3"></a>
</span><span id="__span-32-4"><a id="__codelineno-32-4" name="__codelineno-32-4" href="#__codelineno-32-4"></a><span class="n">sorted_solutions</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">candidate_solutions</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">scoring_function</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-32-5"><a id="__codelineno-32-5" name="__codelineno-32-5" href="#__codelineno-32-5"></a><span class="c1"># or</span>
</span><span id="__span-32-6"><a id="__codelineno-32-6" name="__codelineno-32-6" href="#__codelineno-32-6"></a><span class="n">best_solution</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">candidate_solutions</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">scoring_function</span><span class="p">)</span>
</span><span id="__span-32-7"><a id="__codelineno-32-7" name="__codelineno-32-7" href="#__codelineno-32-7"></a><span class="c1"># or</span>
</span><span id="__span-32-8"><a id="__codelineno-32-8" name="__codelineno-32-8" href="#__codelineno-32-8"></a><span class="n">results</span> <span class="o">=</span> <span class="n">nlargest</span><span class="p">(</span><span class="n">num_solutions</span><span class="p">,</span> <span class="n">results</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">evaluate</span><span class="p">)</span>  <span class="c1"># evaluate each design point</span>
</span></code></pre></div>
<h3 id="hardware-parameter-search">Hardware Parameter Search</h3>
<h4 id="introduction">Introduction</h4>
<p>So far, we have been able to compute the optimal dataflow mapping parameters for each convolution layer under a given hardware configuration. Next, we want <code>EyerissMapper</code> to automatically find the optimal hardware configuration for us using the same evaluation criteria. We can achieve this by slightly modifying the <code>EyerissMapper.run()</code> function to consider different hardware configurations as well. The modified code is as follows:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-33-1"><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span>
</span><span id="__span-33-2"><a id="__codelineno-33-2" name="__codelineno-33-2" href="#__codelineno-33-2"></a>    <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-33-3"><a id="__codelineno-33-3" name="__codelineno-33-3" href="#__codelineno-33-3"></a>    <span class="n">conv2d</span><span class="p">:</span> <span class="n">Conv2DShapeParam</span><span class="p">,</span>
</span><span id="__span-33-4"><a id="__codelineno-33-4" name="__codelineno-33-4" href="#__codelineno-33-4"></a>    <span class="n">maxpool</span><span class="p">:</span> <span class="n">MaxPool2DShapeParam</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-33-5"><a id="__codelineno-33-5" name="__codelineno-33-5" href="#__codelineno-33-5"></a>    <span class="n">num_solutions</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="__span-33-6"><a id="__codelineno-33-6" name="__codelineno-33-6" href="#__codelineno-33-6"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">AnalysisResult</span><span class="p">]:</span>
</span><span id="__span-33-7"><a id="__codelineno-33-7" name="__codelineno-33-7" href="#__codelineno-33-7"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">analyzer</span><span class="o">.</span><span class="n">conv_shape</span> <span class="o">=</span> <span class="n">conv2d</span>
</span><span id="__span-33-8"><a id="__codelineno-33-8" name="__codelineno-33-8" href="#__codelineno-33-8"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">analyzer</span><span class="o">.</span><span class="n">maxpool_shape</span> <span class="o">=</span> <span class="n">maxpool</span>
</span><span id="__span-33-9"><a id="__codelineno-33-9" name="__codelineno-33-9" href="#__codelineno-33-9"></a>
</span><span id="__span-33-10"><a id="__codelineno-33-10" name="__codelineno-33-10" href="#__codelineno-33-10"></a>    <span class="n">results</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">AnalysisResult</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-33-11"><a id="__codelineno-33-11" name="__codelineno-33-11" href="#__codelineno-33-11"></a>
</span><span id="__span-33-12"><a id="__codelineno-33-12" name="__codelineno-33-12" href="#__codelineno-33-12"></a>    <span class="k">for</span> <span class="n">hardware</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_hardware</span><span class="p">():</span>  <span class="c1"># Construct the search space for hardware parameters</span>
</span><span id="__span-33-13"><a id="__codelineno-33-13" name="__codelineno-33-13" href="#__codelineno-33-13"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">analyzer</span><span class="o">.</span><span class="n">hardware</span> <span class="o">=</span> <span class="n">hardware</span>      <span class="c1"># Reconfigure the hardware parameters</span>
</span><span id="__span-33-14"><a id="__codelineno-33-14" name="__codelineno-33-14" href="#__codelineno-33-14"></a>
</span><span id="__span-33-15"><a id="__codelineno-33-15" name="__codelineno-33-15" href="#__codelineno-33-15"></a>        <span class="k">for</span> <span class="n">mapping</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_mappings</span><span class="p">():</span>
</span><span id="__span-33-16"><a id="__codelineno-33-16" name="__codelineno-33-16" href="#__codelineno-33-16"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">analyzer</span><span class="o">.</span><span class="n">mapping</span> <span class="o">=</span> <span class="n">mapping</span>
</span><span id="__span-33-17"><a id="__codelineno-33-17" name="__codelineno-33-17" href="#__codelineno-33-17"></a>            <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analyzer</span><span class="o">.</span><span class="n">summary</span>
</span><span id="__span-33-18"><a id="__codelineno-33-18" name="__codelineno-33-18" href="#__codelineno-33-18"></a>            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
</span><span id="__span-33-19"><a id="__codelineno-33-19" name="__codelineno-33-19" href="#__codelineno-33-19"></a>
</span><span id="__span-33-20"><a id="__codelineno-33-20" name="__codelineno-33-20" href="#__codelineno-33-20"></a>    <span class="n">results</span> <span class="o">=</span> <span class="n">nlargest</span><span class="p">(</span><span class="n">num_solutions</span><span class="p">,</span> <span class="n">results</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">evaluate</span><span class="p">)</span>
</span><span id="__span-33-21"><a id="__codelineno-33-21" name="__codelineno-33-21" href="#__codelineno-33-21"></a>    <span class="k">return</span> <span class="n">results</span>
</span></code></pre></div>
<p>In this modified code, we added a loop to search for <code>EyerissHardwareParam</code> values and used <code>EyerissMapper.generate_hardware()</code> to construct the search space.</p>
<h4 id="design-space-construction-for-hardware-specification">Design Space Construction for Hardware Specification</h4>
<p>In the sample code provided by the TA, the <code>EyerissMapper.generate_hardware()</code> method has already been implemented. The method for generating the search space is similar to <code>EyerissMapper.generate_mappings()</code> from the previous section, but each hardware parameter currently has only one value. This means that the constructed search space <code>candidate_solutions</code> contains only a single element.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-34-1"><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">generate_hardware</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">EyerissHardwareParam</span><span class="p">]:</span>
</span><span id="__span-34-2"><a id="__codelineno-34-2" name="__codelineno-34-2" href="#__codelineno-34-2"></a>    <span class="c1"># Add more values to the following lists to explore more solutions</span>
</span><span id="__span-34-3"><a id="__codelineno-34-3" name="__codelineno-34-3" href="#__codelineno-34-3"></a>    <span class="n">pe_array_h_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">6</span><span class="p">]</span>
</span><span id="__span-34-4"><a id="__codelineno-34-4" name="__codelineno-34-4" href="#__codelineno-34-4"></a>    <span class="n">pe_array_w_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">8</span><span class="p">]</span>
</span><span id="__span-34-5"><a id="__codelineno-34-5" name="__codelineno-34-5" href="#__codelineno-34-5"></a>    <span class="n">ifmap_spad_size_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">12</span><span class="p">]</span>
</span><span id="__span-34-6"><a id="__codelineno-34-6" name="__codelineno-34-6" href="#__codelineno-34-6"></a>    <span class="n">filter_spad_size_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">48</span><span class="p">]</span>
</span><span id="__span-34-7"><a id="__codelineno-34-7" name="__codelineno-34-7" href="#__codelineno-34-7"></a>    <span class="n">psum_spad_size_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">16</span><span class="p">]</span>
</span><span id="__span-34-8"><a id="__codelineno-34-8" name="__codelineno-34-8" href="#__codelineno-34-8"></a>    <span class="n">glb_size_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">64</span> <span class="o">*</span> <span class="mi">2</span><span class="o">**</span><span class="mi">10</span><span class="p">]</span>
</span><span id="__span-34-9"><a id="__codelineno-34-9" name="__codelineno-34-9" href="#__codelineno-34-9"></a>    <span class="n">bus_bw_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">4</span><span class="p">]</span>
</span><span id="__span-34-10"><a id="__codelineno-34-10" name="__codelineno-34-10" href="#__codelineno-34-10"></a>    <span class="n">noc_bw_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">4</span><span class="p">]</span>
</span><span id="__span-34-11"><a id="__codelineno-34-11" name="__codelineno-34-11" href="#__codelineno-34-11"></a>
</span><span id="__span-34-12"><a id="__codelineno-34-12" name="__codelineno-34-12" href="#__codelineno-34-12"></a>    <span class="n">candidate_solutions</span> <span class="o">=</span> <span class="n">product</span><span class="p">(</span>
</span><span id="__span-34-13"><a id="__codelineno-34-13" name="__codelineno-34-13" href="#__codelineno-34-13"></a>        <span class="n">pe_array_h_list</span><span class="p">,</span>
</span><span id="__span-34-14"><a id="__codelineno-34-14" name="__codelineno-34-14" href="#__codelineno-34-14"></a>        <span class="n">pe_array_w_list</span><span class="p">,</span>
</span><span id="__span-34-15"><a id="__codelineno-34-15" name="__codelineno-34-15" href="#__codelineno-34-15"></a>        <span class="n">ifmap_spad_size_list</span><span class="p">,</span>
</span><span id="__span-34-16"><a id="__codelineno-34-16" name="__codelineno-34-16" href="#__codelineno-34-16"></a>        <span class="n">filter_spad_size_list</span><span class="p">,</span>
</span><span id="__span-34-17"><a id="__codelineno-34-17" name="__codelineno-34-17" href="#__codelineno-34-17"></a>        <span class="n">psum_spad_size_list</span><span class="p">,</span>
</span><span id="__span-34-18"><a id="__codelineno-34-18" name="__codelineno-34-18" href="#__codelineno-34-18"></a>        <span class="n">glb_size_list</span><span class="p">,</span>
</span><span id="__span-34-19"><a id="__codelineno-34-19" name="__codelineno-34-19" href="#__codelineno-34-19"></a>        <span class="n">bus_bw_list</span><span class="p">,</span>
</span><span id="__span-34-20"><a id="__codelineno-34-20" name="__codelineno-34-20" href="#__codelineno-34-20"></a>        <span class="n">noc_bw_list</span><span class="p">,</span>
</span><span id="__span-34-21"><a id="__codelineno-34-21" name="__codelineno-34-21" href="#__codelineno-34-21"></a>    <span class="p">)</span>
</span><span id="__span-34-22"><a id="__codelineno-34-22" name="__codelineno-34-22" href="#__codelineno-34-22"></a>    <span class="n">candidate_solutions</span> <span class="o">=</span> <span class="p">[</span><span class="n">EyerissHardwareParam</span><span class="p">(</span><span class="o">*</span><span class="n">m</span><span class="p">)</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">candidate_solutions</span><span class="p">]</span>
</span><span id="__span-34-23"><a id="__codelineno-34-23" name="__codelineno-34-23" href="#__codelineno-34-23"></a>    <span class="k">return</span> <span class="n">candidate_solutions</span>
</span></code></pre></div>
<p>For the assignment, students are required to modify this function based on the Roofline model analysis (compute-bound or memory-bound). They should add more candidate solutions or introduce constraints, explain the reasoning behind these modifications in their report, and use actual data to demonstrate how the newly added hardware configurations address performance bottlenecks.</p>
<h2 id="practice">Practice</h2>
<h3 id="prerequisites">Prerequisites</h3>
<ol>
<li>Download the sample code and report template from Moodle and then decompress it.
    <div class="language-bash highlight"><pre><span></span><code><span id="__span-35-1"><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a>unzip<span class="w"> </span>aoc2025-lab2.zip
</span></code></pre></div></li>
<li>Create and activate virtual environment for AOC labs.
    <div class="language-bash highlight"><pre><span></span><code><span id="__span-36-1"><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a>conda<span class="w"> </span>create<span class="w"> </span>-n<span class="w"> </span>aoc<span class="w"> </span><span class="nv">python</span><span class="o">=</span><span class="m">3</span>.10<span class="w"> </span>-y
</span><span id="__span-36-2"><a id="__codelineno-36-2" name="__codelineno-36-2" href="#__codelineno-36-2"></a>conda<span class="w"> </span>activate<span class="w"> </span>aoc
</span></code></pre></div></li>
<li>Install dependency packages
    <div class="language-bash highlight"><pre><span></span><code><span id="__span-37-1"><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a><span class="nb">cd</span><span class="w"> </span>aoc2025-lab2
</span><span id="__span-37-2"><a id="__codelineno-37-2" name="__codelineno-37-2" href="#__codelineno-37-2"></a>pip<span class="w"> </span>install<span class="w"> </span>-r<span class="w"> </span>requirements.txt
</span></code></pre></div></li>
</ol>
<div class="admonition warning">
<p class="admonition-title">Important</p>
<p>Please ensure that your Conda environment uses a Python version <strong>greater than 3.10</strong>, as we rely on its new features (e.g., simplified type hints and <code>match-case</code> syntax) in this lab.</p>
</div>
<p>After unzipped the file, the directory structure will look like below:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-38-1"><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a><span class="nv">$PROJECT_ROOT</span>
</span><span id="__span-38-2"><a id="__codelineno-38-2" name="__codelineno-38-2" href="#__codelineno-38-2"></a>├──<span class="w"> </span>analytical_model
</span><span id="__span-38-3"><a id="__codelineno-38-3" name="__codelineno-38-3" href="#__codelineno-38-3"></a>│<span class="w">   </span>├──<span class="w"> </span>__init__.py
</span><span id="__span-38-4"><a id="__codelineno-38-4" name="__codelineno-38-4" href="#__codelineno-38-4"></a>│<span class="w">   </span>├──<span class="w"> </span>eyeriss.py
</span><span id="__span-38-5"><a id="__codelineno-38-5" name="__codelineno-38-5" href="#__codelineno-38-5"></a>│<span class="w">   </span>└──<span class="w"> </span>mapper.py
</span><span id="__span-38-6"><a id="__codelineno-38-6" name="__codelineno-38-6" href="#__codelineno-38-6"></a>├──<span class="w"> </span>layer_info.py
</span><span id="__span-38-7"><a id="__codelineno-38-7" name="__codelineno-38-7" href="#__codelineno-38-7"></a>├──<span class="w"> </span>lib
</span><span id="__span-38-8"><a id="__codelineno-38-8" name="__codelineno-38-8" href="#__codelineno-38-8"></a>│<span class="w">   </span>├──<span class="w"> </span>models
</span><span id="__span-38-9"><a id="__codelineno-38-9" name="__codelineno-38-9" href="#__codelineno-38-9"></a>│<span class="w">   </span>│<span class="w">   </span>├──<span class="w"> </span>__init__.py
</span><span id="__span-38-10"><a id="__codelineno-38-10" name="__codelineno-38-10" href="#__codelineno-38-10"></a>│<span class="w">   </span>│<span class="w">   </span>├──<span class="w"> </span>lenet.py
</span><span id="__span-38-11"><a id="__codelineno-38-11" name="__codelineno-38-11" href="#__codelineno-38-11"></a>│<span class="w">   </span>│<span class="w">   </span>├──<span class="w"> </span>mlp.py
</span><span id="__span-38-12"><a id="__codelineno-38-12" name="__codelineno-38-12" href="#__codelineno-38-12"></a>│<span class="w">   </span>│<span class="w">   </span>├──<span class="w"> </span>qconfig.py
</span><span id="__span-38-13"><a id="__codelineno-38-13" name="__codelineno-38-13" href="#__codelineno-38-13"></a>│<span class="w">   </span>│<span class="w">   </span>└──<span class="w"> </span>vgg.py
</span><span id="__span-38-14"><a id="__codelineno-38-14" name="__codelineno-38-14" href="#__codelineno-38-14"></a>│<span class="w">   </span>└──<span class="w"> </span>utils
</span><span id="__span-38-15"><a id="__codelineno-38-15" name="__codelineno-38-15" href="#__codelineno-38-15"></a>│<span class="w">       </span>├──<span class="w"> </span>dataset.py
</span><span id="__span-38-16"><a id="__codelineno-38-16" name="__codelineno-38-16" href="#__codelineno-38-16"></a>│<span class="w">       </span>├──<span class="w"> </span>__init__.py
</span><span id="__span-38-17"><a id="__codelineno-38-17" name="__codelineno-38-17" href="#__codelineno-38-17"></a>│<span class="w">       </span>└──<span class="w"> </span>utils.py
</span><span id="__span-38-18"><a id="__codelineno-38-18" name="__codelineno-38-18" href="#__codelineno-38-18"></a>├──<span class="w"> </span>main.py
</span><span id="__span-38-19"><a id="__codelineno-38-19" name="__codelineno-38-19" href="#__codelineno-38-19"></a>├──<span class="w"> </span>network_parser
</span><span id="__span-38-20"><a id="__codelineno-38-20" name="__codelineno-38-20" href="#__codelineno-38-20"></a>│<span class="w">   </span>├──<span class="w"> </span>__init__.py
</span><span id="__span-38-21"><a id="__codelineno-38-21" name="__codelineno-38-21" href="#__codelineno-38-21"></a>│<span class="w">   </span>├──<span class="w"> </span>network_parser.py
</span><span id="__span-38-22"><a id="__codelineno-38-22" name="__codelineno-38-22" href="#__codelineno-38-22"></a>│<span class="w">   </span>└──<span class="w"> </span>torch2onnx.py
</span><span id="__span-38-23"><a id="__codelineno-38-23" name="__codelineno-38-23" href="#__codelineno-38-23"></a>├──<span class="w"> </span>onnx_inference.py
</span><span id="__span-38-24"><a id="__codelineno-38-24" name="__codelineno-38-24" href="#__codelineno-38-24"></a>├──<span class="w"> </span>profiling.py
</span><span id="__span-38-25"><a id="__codelineno-38-25" name="__codelineno-38-25" href="#__codelineno-38-25"></a>├──<span class="w"> </span>report.md
</span><span id="__span-38-26"><a id="__codelineno-38-26" name="__codelineno-38-26" href="#__codelineno-38-26"></a>├──<span class="w"> </span>requirements.txt
</span><span id="__span-38-27"><a id="__codelineno-38-27" name="__codelineno-38-27" href="#__codelineno-38-27"></a>└──<span class="w"> </span>weights
</span><span id="__span-38-28"><a id="__codelineno-38-28" name="__codelineno-38-28" href="#__codelineno-38-28"></a><span class="w">    </span>├──<span class="w"> </span>vgg8-power2.pt
</span><span id="__span-38-29"><a id="__codelineno-38-29" name="__codelineno-38-29" href="#__codelineno-38-29"></a><span class="w">    </span>└──<span class="w"> </span>vgg8.pt
</span></code></pre></div>
<p>Note that the <code>lib/models</code> and <code>lib/utils</code> directories contains the code from lab1. If you have designed your own model architecture other than the VGG-8 provided by the TA and you want to perform lab2's analysis with your own model, please put it into <code>lib/models</code>.</p>
<h3 id="1-workload-analysis">1. Workload Analysis</h3>
<p>Use the <code>profiling.py</code> script provided in the lab analyze the computational breakdown of each operator in the model you used for Lab 1. To check the usage of <code>profiling.py</code>, run:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-39-1"><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a><span class="nb">cd</span><span class="w"> </span><span class="nv">$PROJECT_ROOT</span>
</span><span id="__span-39-2"><a id="__codelineno-39-2" name="__codelineno-39-2" href="#__codelineno-39-2"></a>python3<span class="w"> </span>profiling.py<span class="w"> </span>-h
</span></code></pre></div>
<p>For example, to profile a full-precision model, execute:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-40-1"><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a>python3<span class="w"> </span>profiling.py<span class="w"> </span><span class="nv">$PATH_TO_FP32_MODEL</span>
</span></code></pre></div>
<p>To profile a quantized model, remember to specify the quantization backend by the <code>--backend</code> or <code>-b</code> option.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-41-1"><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a>python3<span class="w"> </span>profiling.py<span class="w"> </span><span class="nv">$PATH_TO_INT8_MODEL</span><span class="w"> </span>-b<span class="w"> </span>power2
</span></code></pre></div>
<p>Your report should include:</p>
<ul>
<li>Architecture of your model you used</li>
<li>Profiling results for the full-precision model</li>
<li>Profiling results for the quantized model</li>
<li>Analysis and comparison</li>
</ul>
<p>Either as screenshots or copied output text is acceptable.</p>
<h3 id="2-network-parser">2. Network Parser</h3>
<p>In Lab 5, we will use an ONNX-format model as input for the AI compiler. In this lab, we will learn how to convert a model into a format that an analytical model can process. The definition of that format is defined with Python <a href="https://docs.python.org/3/library/dataclasses.html">dataclass</a> and previously-mentioned in <a href="#defining-layer-information-class">Defining Layer Information Class</a>. The provided example code includes a script for converting PyTorch models to ONNX, and the lecture notes explain how to parse PyTorch models.</p>
<p>Students are required to complete the following two functions defined in <code>network_parser/network_parser.py</code> and used to convert models into the format defined in <code>layer_info.py</code>:</p>
<ol>
<li>(10%) <code>parse_pytorch(model: nn.Module, input_shape: tuple[int]) -&gt; list[ShapeParam]</code></li>
<li>(10%) <code>parse_onnx(model: onnx.ModelProto) -&gt; list[ShapeParam]</code></li>
</ol>
<p>You may create your own test program or function to verify the correctness of your implementation.</p>
<h3 id="3-analytical-model">3. Analytical Model</h3>
<p>Given a set of hardware and mapping parameters, we aim to estimate the performance achievable with this system configuration and the associated cost for each convolutional block (<strong>Conv2d+ReLU</strong> or <strong>Conv2d+ReLU+MaxPool2d</strong>).</p>
<p>The metrics to evaluate are listed below, and some of those have been demonstrated by TA in the handout and sample code:</p>
<ul>
<li><strong>GLB usage per processing pass</strong> (unit: bytes): including ifmap, filter, bias, and psum</li>
<li><strong>GLB access</strong> (unit: bytes): including ifmap read, filter read, bias read, psum read, psum write, and ofmap write</li>
<li><strong>DRAM access</strong> (unit: bytes): including ifmap read, filter read, bias read, and ofmap write</li>
<li><strong>number of MACs</strong></li>
<li><strong>latency of inference</strong> (unit: cycles)</li>
<li><strong>power consumption</strong> (unit: μW)</li>
<li><strong>energy consumption</strong> (unit: μJ)</li>
</ul>
<p>To complete this assignment, students must:</p>
<ol>
<li>(15%) Compute the performance metrics using the notation from the <strong>Eyeriss paper</strong> and write down the equations in <strong><em>LaTeX</em></strong> format in your report.</li>
<li>(15%) Implement the specified getter functions in the <code>EyerissAnalyzer</code> class in <code>analytical_model/eyeriss.py</code>. <strong>Students must strictly follow the API specifications</strong> defined in the lecture notes and sample code, including input and output data types for each function. Grading will be based on the success rate of automated tests, including edge case evaluations.</li>
</ol>
<p>Similarly, you can create your own test program or function to verify the correctness of your implementation.</p>
<h3 id="4-roofline-model">4. Roofline Model</h3>
<ol>
<li>(5%) Derive the operational intensity of the 2D convolution kernel using the notation from the Eyeriss paper in LaTeX. Then, estimate its complexity with Big-O notation.</li>
<li>
<p>(5%) Estimate the operational intensity of the following Conv2D kernel size, plot this kernel onto the roofline model of peak performance 48 MACs/cycle and peak bandwidth 4 byte/cycle, and determine which type of performance bound such kernel is in your report.</p>
<table>
<thead>
<tr>
<th>N</th>
<th>M</th>
<th>C</th>
<th>H/W</th>
<th>R/S</th>
<th>E/F</th>
<th>P (padding)</th>
<th>U (stride)</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>64</td>
<td>3</td>
<td>32</td>
<td>3</td>
<td>32</td>
<td>1</td>
<td>1</td>
</tr>
</tbody>
</table>
</li>
</ol>
<h3 id="5-design-space-exploration">5. Design Space Exploration</h3>
<p>Consider an Eyeriss-based accelerator with the following configurations:</p>
<ul>
<li><strong>6×8 PE array</strong></li>
<li><strong>64 KiB global buffer</strong></li>
<li><strong>76 bytes of scratchpad memory per PE</strong>:</li>
<li>12 bytes for <strong>ifmap</strong></li>
<li>48 bytes for <strong>filter</strong></li>
<li>16 bytes for <strong>psum</strong></li>
<li><strong>4-byte bus and NoC bitwidth</strong> (transfers 4 bytes per cycle)</li>
</ul>
<p>Complete the following 3 tasks:</p>
<ol>
<li><strong>Search Space Construction for Dataflow Mappings (10%)</strong>
   Implement the <code>generate_mappings()</code> method in <code>EyerissMapper</code> (located in <code>analytical_model/mapper.py</code>) to generate candidate mapping parameters using the provided <code>*_available()</code> methods. Filter out invalid configurations using the <code>validate()</code> method.</li>
<li><strong>Evaluation Algorithm Design (10%)</strong> Develop an evaluation algorithm in the <code>evaluate()</code> method of <code>EyerissMapper</code> to assess the quality of a given mapping based on analytical model performance metrics.<ul>
<li>Describe the design and logic of your algorithm in the report. (What performance metric(s) are considered, and why?)</li>
<li>Integrate it with the analytical model and network parser for end-to-end analysis. (triggered by the <code>main.py</code>, which will be described latter)</li>
<li>Include the generated CSV output file (<code>dse_mappings.csv</code>) in your submission, containing the mapping parameters and corresponding performance metrics for the top 3 candidate solutions of each Conv2D layer.</li>
<li>List the best candidate solutions per layer selected by your algorithm in the report.</li>
</ul>
</li>
<li><strong>Search Space Expansion for Hardware Configurations (10%)</strong>
   Modify the <code>generate_hardware()</code> method in <code>EyerissMapper</code> to expand the search space for hardware parameters based on Roofline model analysis (compute-bound vs. memory-bound).<ul>
<li>Explain the rationale for your modifications in the report.</li>
<li>Use actual data to demonstrate how your updated hardware configurations mitigate performance bottlenecks.</li>
<li>Include the generated CSV output file (<code>dse_all.csv</code>) in your submission, containing the hardware parameters, mapping parameter, and corresponding performance metrics for the top 3 candidate solutions of each Conv2D layer.</li>
</ul>
</li>
</ol>
<p>These tasks do not have a single correct solution—creativity is encouraged.</p>
<p>A <code>main.py</code> script is provided in the project root, integrating the network parser, analytical model, and design space exploration. To view usage options, run:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-42-1"><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a>python3<span class="w"> </span>main.py<span class="w"> </span>-h
</span></code></pre></div>
<p>Basic case:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-43-1"><a id="__codelineno-43-1" name="__codelineno-43-1" href="#__codelineno-43-1"></a>python3<span class="w"> </span>main.py<span class="w"> </span>./weights/vgg8-power2.pt<span class="sb">`</span>
</span></code></pre></div>
<p>More complex scenario:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-44-1"><a id="__codelineno-44-1" name="__codelineno-44-1" href="#__codelineno-44-1"></a>python3<span class="w"> </span>main.py<span class="w"> </span>-f<span class="w"> </span>onnx<span class="w"> </span>-o<span class="w"> </span>log/<span class="k">$(</span>date<span class="w"> </span>-I<span class="k">)</span><span class="w"> </span>vgg-power2.onnx
</span></code></pre></div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../lab1/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Lab 1 - AI Model Design and Quantization">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Lab 1 - AI Model Design and Quantization
              </div>
            </div>
          </a>
        
        
          
          <a href="../lab3/" class="md-footer__link md-footer__link--next" aria-label="Next: Lab 3 - Hardware Architecture Design">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                Lab 3 - Hardware Architecture Design
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/NCKU-AISLAB/force-ai" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "navigation.path", "navigation.top", "navigation.footer", "content.code.copy", "content.code.select", "content.code.annotate"], "search": "../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.13a4f30d.min.js"></script>
      
        <script src="../../javascripts/mathjax.js"></script>
      
        <script src="https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js"></script>
      
        <script src="https://cdn.jsdelivr.net/gh/rod2ik/cdn@main/mkdocs/javascripts/mkdocs-graphviz.js"></script>
      
    
  </body>
</html>